# Analysis Launch Protocol v1.0
# 调研启动协议 - 确保每次分析都不漏执行
# 用户端要求 + Agent端自检 = 双向保障

version: "1.0"
created: "2026-01-31"

purpose: |
  解决问题：框架写得很完善，但启动时没有明确要求，导致执行打折扣。

  解决方案：定义标准化的"调研启动协议"
  - 用户端：明确表达深度要求
  - Agent端：收到请求后自动触发检查
  - 双向保障：不漏掉任何规划

# ============================================================
# 用户端：推荐的调研请求模板
# ============================================================
user_request_template:

  description: |
    用户在发起分析请求时，建议使用以下模板或包含关键要素。
    这些要素会触发Agent的完整执行协议。

  # --------------------------------------------------------
  basic_template:
    name: "基础模板"
    format: |
      请深度分析 [公司名/代码]

      要求：
      1. 机构级深度（对标TSM/MU报告）
      2. 字数≥6万字
      3. 完整执行4阶段框架
      4. 从本季度财报变化开始

    example: |
      请深度分析 P&G 宝洁公司

      要求：
      1. 机构级深度（对标TSM 63000字报告）
      2. 字数≥6万字
      3. 完整执行4阶段框架
      4. 从Q2 FY2026财报变化开始
      5. 消费品框架完整执行（10品类逐一分析）

  # --------------------------------------------------------
  advanced_template:
    name: "高级模板（推荐）"
    format: |
      请深度分析 [公司名/代码]

      【深度要求】
      - 对标报告：[指定历史最佳报告]
      - 最低字数：[X万字]
      - 深度评分：≥[X]分

      【必须模块】
      - [ ] 本季度财报变化与战略分析
      - [ ] 生态图谱（Mermaid）
      - [ ] 竞品逐一深度分析
      - [ ] 品类/产品线逐一分析
      - [ ] 护城河6类+7Powers
      - [ ] 反常识洞察≥5张
      - [ ] 估值模型+敏感性
      - [ ] Kill Switch≥10个
      - [ ] 可验证预测≥15个

      【行业特定】
      - [行业特定模块1]
      - [行业特定模块2]

      【输出格式】
      - 完整Markdown报告
      - 每个Phase完成后输出检查点
      - 报告末尾输出质量门控结果

    example: |
      请深度分析 P&G 宝洁公司

      【深度要求】
      - 对标报告：TSM_Complete_Analysis (63,000字)
      - 最低字数：8万字（消费品复杂度系数1.5）
      - 深度评分：≥7.5分

      【必须模块】
      - [ ] Q2 FY2026财报变化与战略分析
      - [ ] P&G生态图谱（上下游+渠道+竞品）
      - [ ] Unilever/Colgate/KC竞品逐一深度分析
      - [ ] 10个品类逐一分析（Beauty/Grooming/Health/...）
      - [ ] Top 20品牌感官签名分析
      - [ ] 8大行为护城河逐一分析
      - [ ] PVM增长质量10年趋势
      - [ ] 渠道经济学（Walmart/Amazon/Target/DTC）
      - [ ] 反常识洞察≥5张，每张≥300字
      - [ ] Kill Switch≥10个
      - [ ] 可验证预测≥15个

      【消费品特定】
      - VoC消费者声音分析
      - 品牌资产估值（Interbrand方法）
      - 供应链4层风险评估
      - 哨兵监控信号设置

      【输出格式】
      - 完整Markdown报告
      - 每个Phase完成后输出检查点状态
      - 报告末尾输出质量门控结果

  # --------------------------------------------------------
  trigger_keywords:
    description: "包含这些关键词会触发更严格的执行"

    depth_triggers:
      - "机构级"
      - "深度分析"
      - "完整分析"
      - "对标TSM"
      - "对标MU"
      - "6万字"
      - "8万字"

    industry_triggers:
      consumer: ["消费品", "品牌", "渠道", "PVM", "VoC"]
      semiconductor: ["半导体", "周期", "设备", "Fab", "HBM"]
      technology: ["科技", "平台", "生态", "网络效应"]

    quality_triggers:
      - "不能简化"
      - "不能缩水"
      - "必须完整"
      - "每个品类都要分析"
      - "逐一分析"

# ============================================================
# Agent端：收到请求后的自动检查
# ============================================================
agent_auto_checks:

  description: |
    Agent收到分析请求后，自动执行以下检查。
    即使用户没有明确要求，Agent也应该主动触发。

  # --------------------------------------------------------
  step_1_request_parsing:
    name: "解析请求"
    actions:
      - "识别目标公司"
      - "识别行业类型"
      - "识别深度要求关键词"
      - "识别用户明确的模块要求"

  # --------------------------------------------------------
  step_2_benchmark_loading:
    name: "加载标杆"
    actions:
      - "查找 reports/ 目录下的历史最佳报告"
      - "统计标杆指标（字数/表格/图/洞察）"
      - "设定本次最低目标"
    output: |
      ## 标杆对照
      | 指标 | 标杆值 | 本次目标 |
      |------|--------|---------|
      | 字数 | 63,000 | 60,000 |
      | 表格 | 35 | 30 |
      | Mermaid图 | 6 | 5 |

  # --------------------------------------------------------
  step_3_complexity_calculation:
    name: "计算复杂度"
    actions:
      - "确定行业基础系数"
      - "计算公司特定调整"
      - "得出最终复杂度系数"
      - "调整最低字数要求"
    output: |
      ## 复杂度计算
      - 行业: 消费品 (基础系数 1.2)
      - 品类数: 10 (+0.35)
      - 品牌数: 65 (+0.55)
      - 地理: 全球 (+0.1)
      - **最终系数**: 2.2
      - **调整后最低字数**: 80,000

  # --------------------------------------------------------
  step_4_module_checklist:
    name: "生成模块清单"
    actions:
      - "根据行业类型，生成必须执行的模块清单"
      - "用户明确要求的模块标记为'必须'"
      - "输出完整清单供确认"
    output: |
      ## 本次分析模块清单

      ### Phase 1: 定位与生态
      - [ ] 本季度财报变化分析
      - [ ] 产业链定位图
      - [ ] 生态图谱（Mermaid）
      - [ ] 公司类型识别

      ### Phase 2: 数据收集
      - [ ] 财务数据（≥5年）
      - [ ] 分析师观点（≥10位深度引用）
      - [ ] 市场分歧（≥5个）
      - [ ] 领先指标

      ### Phase 3: 深度分析
      - [ ] 护城河6类+7Powers（≥5000字）
      - [ ] 竞品逐一分析（每个≥1500字）
      - [ ] [行业特定模块...]
      - [ ] 核心命题（≥3个）
      - [ ] 反常识洞察（≥5张，每张≥300字）

      ### Phase 4: 估值与决策
      - [ ] DCF详细模型
      - [ ] SOTP三场景
      - [ ] 敏感性分析
      - [ ] Kill Switch（≥10个）
      - [ ] 可验证预测（≥15个）

  # --------------------------------------------------------
  step_5_commitment_output:
    name: "输出深度承诺"
    description: "正式开始前，输出深度承诺供用户确认"
    output: |
      ## 深度承诺

      **目标公司**: [公司名]
      **行业类型**: [行业]
      **复杂度系数**: [X.X]

      | 指标 | 标杆值 | 本次目标 |
      |------|--------|---------|
      | 字数 | XX,XXX | XX,XXX |
      | 表格 | XX | XX |
      | Mermaid图 | X | X |
      | 洞察卡 | X | X |
      | 预测数 | XX | XX |

      **开始时间**: [时间戳]

      ⚠️ 承诺：本次分析将严格执行v19.7深度保障系统，
      任何指标不达标将返工补充。

# ============================================================
# 行业特定模块清单
# ============================================================
industry_specific_modules:

  consumer_goods:
    name: "消费品"
    mandatory_modules:
      - name: "品类逐一分析"
        requirement: "每个主要品类≥1500字"
        for_pg: "10个品类：Beauty/Grooming/Health/Fabric/Baby/Feminine/Family/Home/Oral/Personal"

      - name: "品牌感官签名"
        requirement: "Top 20品牌的视觉/听觉/触觉/味嗅觉签名"

      - name: "8大行为护城河"
        requirement: "逐一分析：Experience/Status/Hero/Random/Fear/Rewards/Certainty/Scarcity"

      - name: "PVM增长质量"
        requirement: "10年趋势 + 健康vs空心化诊断"

      - name: "渠道经济学"
        requirement: "每个主要渠道单独分析（Walmart/Amazon/Target/DTC）"

      - name: "VoC消费者声音"
        requirement: "主题分类 + 情绪分析 + 漂移检测"

      - name: "竞品矩阵"
        requirement: "6维度系统对比（品牌/产品/渠道/营销/定价/财务）"

      - name: "供应链4层"
        requirement: "原材料→生产→物流→库存"

      - name: "品牌资产估值"
        requirement: "Interbrand方法 + Aaker 5维模型"

  semiconductor:
    name: "半导体"
    mandatory_modules:
      - name: "6层周期雷达"
        requirement: "Layer -1到Layer 3逐层分析"

      - name: "供需模型"
        requirement: "供需平衡 + 价格预测"

      - name: "技术路线图"
        requirement: "制程演进 + 关键技术节点"

      - name: "中国风险评估"
        requirement: "制裁影响 + 本土化进展"

      - name: "周期定位"
        requirement: "P1-P5阶段判断 + 温度计"

  technology_platform:
    name: "科技平台"
    mandatory_modules:
      - name: "生态图谱"
        requirement: "平台 + 开发者 + 用户 + 互补者"

      - name: "网络效应分析"
        requirement: "类型 + 强度 + 临界点"

      - name: "技术社区声音"
        requirement: "GitHub/StackOverflow/开发者情绪"

      - name: "AI 7层定位"
        requirement: "L0-L6在AI产业链中的位置"

# ============================================================
# 快速启动指令
# ============================================================
quick_start_commands:

  description: |
    用户可以使用这些快速指令触发完整分析。
    这些指令会自动加载所有必要的要求。

  commands:
    deep_analysis:
      format: "/deep-analysis [公司] [行业]"
      example: "/deep-analysis PG consumer"
      triggers:
        - "加载行业框架"
        - "执行标杆对照"
        - "计算复杂度系数"
        - "生成模块清单"
        - "输出深度承诺"
        - "开始4阶段执行"

    institutional_report:
      format: "/institutional-report [公司]"
      example: "/institutional-report PG"
      triggers:
        - "自动识别行业"
        - "设定最高深度标准"
        - "完整框架执行"
        - "质量门控强制"

# ============================================================
# 用户确认清单（开始前）
# ============================================================
pre_start_confirmation:

  description: |
    在正式开始分析前，建议用户确认以下事项。
    这确保双方对期望一致。

  checklist: |
    ## 分析启动确认清单

    **公司信息**
    - [ ] 公司名称/代码确认
    - [ ] 行业类型确认
    - [ ] 最新财报期间确认

    **深度要求**
    - [ ] 最低字数确认: _____ 字
    - [ ] 对标报告确认: _____
    - [ ] 深度评分目标: ≥_____

    **必须模块**
    - [ ] 模块清单已审核
    - [ ] 行业特定模块已包含
    - [ ] 无遗漏的重要维度

    **输出格式**
    - [ ] 每Phase输出检查点
    - [ ] 报告末尾质量门控
    - [ ] Markdown格式

    **确认开始**: [ ]

# ============================================================
# 版本历史
# ============================================================
version_history:
  v1.0:
    date: "2026-01-31"
    changes:
      - "用户端请求模板（基础+高级）"
      - "Agent端自动检查流程"
      - "行业特定模块清单"
      - "快速启动指令"
      - "启动前确认清单"
