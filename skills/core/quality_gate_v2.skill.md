# Quality Gate v2.0 - 强制执行与结果展示

## 设计原则

这不是"建议"，而是**硬性门控**。报告必须：
1. 通过所有检查才能输出
2. 在报告末尾**显式展示**检查结果
3. 不通过项必须**明确标注**并解释原因

---

## 四层质量检查

### Layer 1: 数据溯源检查（最严格）

每个数字必须有来源标注，格式：
```
[API] - FMP或100baggers API返回
[财报] - 公司财报（标注期间）
[分析师] - 分析师名字/机构
[搜索] - 搜索结果（标注URL）
[估算] - 本报告估算（说明方法）
```

**检查方法**：
1. 扫描报告中所有数字
2. 确认每个关键数字有标注
3. 无标注数字 → 添加标注或删除

### Layer 2: API数据展示检查

**100baggers API（如果调用了）**：
```yaml
⚠️ 重要：7维度雷达图评分过于主观，禁止使用

禁止展示:
  - 7维度雷达图评分（主观权重不透明）
  - 任何综合评分/评级

可以展示:
  - 领先指标触发状态: □ （基于客观阈值）
  - 杜邦三级拆解: □ （纯数学分解）
  - ROIC分析: □ （基于财务数据）
  - 历史趋势对比: □

如果API调用失败:
  - 明确标注"100baggers API不可用"
  - 解释原因（超时/认证失败/其他）
```

**FMP API（必须调用）**：
```yaml
必须展示:
  - 公司概况表: □
  - 估值指标表: □
  - TTM财务数据: □
  - 财务健康度评分: □
  - 现金流质量: □
```

### Layer 3: 深度验证检查

```yaml
内容要求:
  分析师全景表:
    required: true
    minimum_count: 5
    内容: 评级、目标价、核心逻辑、方法论、盲区

  市场分歧表:
    required: true
    minimum_count: 3
    内容: 多头观点、空头观点、本报告立场、关键证据

  核心命题:
    required: true
    minimum_count: 3
    每个命题要求:
      - 明确判断（结论先行）
      - ≥2条证据链
      - 机制分析（为什么）
      - 反证句（但如果___则不成立）

  Kill Switch:
    required: true
    内容: 投资论点失效的具体条件
    位置: 执行摘要
```

### Layer 4: 估值逻辑检查

```yaml
SOTP估值:
  required: true
  内容:
    - ≥3个场景（熊市/基准/牛市）
    - 每个场景有具体假设
    - 概率加权目标价

目标价逻辑:
  rule: "最终目标价与SOTP概率加权的差距必须<20%"

  如果差距>20%:
    必须有详细解释:
      - 为什么偏离SOTP？
      - 调整因素是什么？
      - 调整因素如何量化？

  禁止:
    - 因为"分析师共识是$X"就设目标价为$X
    - 主观"感觉"调整
```

---

## 执行协议

### 输出前强制执行

```
步骤1：数据溯源审计
├── 列出报告中所有关键数字
├── 检查每个是否有来源标注
└── 无标注的 → 添加或删除

步骤2：API数据检查
├── 确认100baggers数据已展示（或标注不可用）
├── 确认FMP数据已展示
└── 缺失的 → 补充

步骤3：深度检查
├── 分析师全景表完整性
├── 市场分歧表完整性
├── 核心命题深度评分
└── Kill Switch存在性

步骤4：估值逻辑检查
├── 计算SOTP概率加权目标价
├── 计算与最终目标价的差距
├── 差距>20% → 添加解释
└── 差距<20% → 通过

步骤5：生成质量门控报告
├── 填写检查结果表
├── 标注不通过项
└── 附在报告末尾
```

---

## 质量门控报告模板

**必须附在每份研究报告末尾**：

```markdown
---

## 质量门控执行结果 v2.0

### 数据溯源
| 检查项 | 状态 | 备注 |
|--------|------|------|
| 关键数字有来源标注 | ✅/❌ | X个数字已标注 |
| 无"凭印象"数据 | ✅/❌ | |
| 数据截止日期 | ✅/❌ | 截止YYYY-MM-DD |

### API数据展示
| 检查项 | 状态 | 备注 |
|--------|------|------|
| 100baggers 杜邦分析 | ✅/❌/N/A | |
| 100baggers ROIC分析 | ✅/❌/N/A | |
| 100baggers 领先指标 | ✅/❌/N/A | |
| ~~100baggers 7维度评分~~ | N/A | 禁用（主观） |
| FMP 公司概况 | ✅/❌ | |
| FMP 估值指标 | ✅/❌ | |
| FMP 财务健康度 | ✅/❌ | |

### 深度验证
| 检查项 | 状态 | 备注 |
|--------|------|------|
| 分析师全景表 | ✅/❌ | X位分析师 |
| 市场分歧表 | ✅/❌ | X个争议点 |
| 核心命题 | ✅/❌ | X个，平均Level X |
| 证据链完整 | ✅/❌ | 每命题≥2条 |
| 机制分析 | ✅/❌ | |
| 反证句 | ✅/❌ | |
| Kill Switch | ✅/❌ | |

### 估值逻辑
| 检查项 | 状态 | 备注 |
|--------|------|------|
| SOTP多场景估值 | ✅/❌ | X个场景 |
| 概率加权目标价 | ✅/❌ | $XXX |
| 最终目标价 | - | $XXX |
| 差距 | ✅/❌ | X%，<20%通过 |
| 敏感性分析 | ✅/❌ | |

### 输出质量
| 检查项 | 状态 | 备注 |
|--------|------|------|
| 总字符数 | ✅/❌ | XXX字符 |
| 反常识洞察 | ✅/❌ | X个 |

---

**总体评估**: ✅ 通过 / ❌ 不通过

**不通过项**:
- [列出具体不通过项及原因]

**改进建议**:
- [下次分析需要注意的点]
```

---

## 与LRCX分析的差距分析

对比LRCX v1.0报告与v2.0标准：

| 检查项 | v1.0状态 | v2.0要求 | 差距 |
|--------|---------|---------|------|
| 数据来源标注 | 部分 | 全部 | 缺少[来源]标签 |
| 100baggers展示 | 未展示 | 必须展示 | **严重缺失** |
| SOTP目标价 | $161 | 作为锚 | 被忽视 |
| 最终目标价 | $250-280 | 基于SOTP | 差距>50% |
| 质量门控报告 | 无 | 必须附上 | **缺失** |

---

## 版本信息

- **版本**: v2.0
- **创建日期**: 2026-01-27
- **核心改进**:
  - 数据溯源强制标注
  - API数据强制展示
  - 估值逻辑自洽检查
  - 质量门控报告模板
