# Agent 8 æ•´åˆæŒ‡å—

**ç›®çš„**: å°†Agent 8ä¸å‰ç½®Agents (1-7)å®Œæ•´æ•´åˆï¼Œå®ç°ç«¯åˆ°ç«¯çš„Top 20ç­›é€‰æµç¨‹

---

## ä¸€ã€æ•°æ®æµæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è‚¡ç¥¨æ±       â”‚  2962å®¶ç¾è‚¡
â”‚  åˆå§‹åŒ–      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Agents 1-7 æ•°æ®ç”Ÿæˆå±‚                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Agent 1: å¸‚åœºæ•°æ®åº“    â†’ agent1_market_data.csv              â”‚
â”‚ Agent 2: SECä¿¡å·å¼•æ“   â†’ agent2_sec_signals.csv              â”‚
â”‚ Agent 3: è´¨é‡è¯„åˆ†å™¨    â†’ agent3_quality_scores.csv           â”‚
â”‚ Agent 4: é£é™©è°ƒæ•´å™¨    â†’ agent4_risk_adjusted.csv            â”‚
â”‚ Agent 5: åŸºæœ¬é¢è¯„åˆ†    â†’ agent5_fundamental_scores.csv       â”‚
â”‚ Agent 6: ä¼°å€¼åˆ†æå™¨    â†’ agent6_valuation_scores.csv         â”‚
â”‚ Agent 7: æ’é™¤è§„åˆ™      â†’ agent7_exclusion_results.csv        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Agent 8: ç»¼åˆæ’åºå¼•æ“                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. æ•°æ®æ•´åˆ   â†’ Company_Master_Table                         â”‚
â”‚ 2. åˆæ­¥ç­›é€‰   â†’ 19-500å®¶å€™é€‰                                 â”‚
â”‚ 3. ç»¼åˆè¯„åˆ†   â†’ Final_Scoreè®¡ç®—                              â”‚
â”‚ 4. æ’åº       â†’ Rank 1-N                                     â”‚
â”‚ 5. å¹³è¡¡è°ƒæ•´   â†’ è¡Œä¸š/å¸‚å€¼åˆ†æ•£                                â”‚
â”‚ 6. æ•æ„Ÿæ€§åˆ†æ â†’ 3ç§æƒé‡æ–¹æ¡ˆ                                  â”‚
â”‚ 7. ç»“æœå¯¼å‡º   â†’ 7ä»½æŠ¥å‘Š                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è¾“å‡ºæˆæœç‰©                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Top_20_Final_List.csv                                      â”‚
â”‚ â€¢ Top_20_Detailed.md                                         â”‚
â”‚ â€¢ Runners_Up_21_to_30.md                                     â”‚
â”‚ â€¢ Sectoral_Analysis.md                                       â”‚
â”‚ â€¢ Sensitivity_Analysis.md                                    â”‚
â”‚ â€¢ Portfolio_Construction.md                                  â”‚
â”‚ â€¢ æ’åºæ–¹æ³•è®º.md                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æ•°æ®å¥‘çº¦ (Data Contract)

### å„Agentå¿…é¡»æä¾›çš„å­—æ®µ

#### Agent 1: å¸‚åœºæ•°æ®åº“
```csv
Ticker, Company_Name, Sector, Market_Cap, Avg_Daily_Volume_USD, Beta, Current_Price
```

#### Agent 2: SECä¿¡å·
```csv
Ticker, SEC_Signal_Score, Insider_Buy_Value, Insider_Sell_Value, Institutional_Holdings_Pct
```

#### Agent 3: è´¨é‡æŒ‡æ ‡
```csv
Ticker, Moat, Moat_Score, ROIC, ROE, ROA, OCF_NI_Ratio, Debt_to_Equity
```

#### Agent 4: é£é™©è°ƒæ•´
```csv
Ticker, Sharpe_Ratio, Sortino_Ratio, Max_Drawdown, Volatility, Risk_Adjusted_Score
```

#### Agent 5: åŸºæœ¬é¢è´¨é‡
```csv
Ticker, Fundamental_Quality_Score, Revenue_Growth, Earnings_Growth, FCF_Margin
```

#### Agent 6: ä¼°å€¼
```csv
Ticker, Valuation_Score, DCF_Fair_Value, Current_Price, DCF_Upside, PE_Ratio, PB_Ratio
```

#### Agent 7: æ’é™¤è§„åˆ™
```csv
Ticker, Passes_Exclusion, Exclusion_Reasons
```

### æ•°æ®è´¨é‡è¦æ±‚

- **å®Œæ•´æ€§**: æ¯ä¸ªå­—æ®µçš„ç¼ºå¤±ç‡<20%
- **ä¸€è‡´æ€§**: æ‰€æœ‰æ–‡ä»¶ä½¿ç”¨ç›¸åŒçš„Tickeræ ¼å¼
- **æ—¶æ•ˆæ€§**: æ•°æ®æˆªæ­¢æ—¥æœŸç»Ÿä¸€ï¼ˆå»ºè®®æ¯æ—¥æ›´æ–°ï¼‰
- **å‡†ç¡®æ€§**: è´¢åŠ¡æ•°æ®æ¥æºäºå®˜æ–¹è´¢æŠ¥

---

## ä¸‰ã€é›†æˆæ­¥éª¤

### Step 1: å‡†å¤‡æ•°æ®ç›®å½•

```bash
cd /Users/milton/æŠ•èµ„å¤§å¸ˆ/Top20_Screener

# åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p data quality risk_metrics valuation results
```

### Step 2: è¿è¡Œå‰ç½®Agents (1-7)

```bash
# å‡è®¾å„Agentæœ‰ç‹¬ç«‹è„šæœ¬
python3 scripts/agent1_market_collector.py   # â†’ data/agent1_market_data.csv
python3 scripts/agent2_sec_signals.py         # â†’ data/agent2_sec_signals.csv
python3 quality/fundamental_quality_scorer.py # â†’ quality/agent3_quality_scores.csv
python3 scripts/sharpe_tail_risk_screener.py  # â†’ risk_metrics/agent4_risk_adjusted.csv
python3 scripts/agent5_fundamental.py         # â†’ data/agent5_fundamental_scores.csv
python3 scripts/agent6_valuation.py           # â†’ valuation/agent6_valuation_scores.csv
python3 scripts/agent7_exclusion_executor.py  # â†’ data/agent7_exclusion_results.csv
```

### Step 3: è¿è¡ŒAgent 8

```bash
python3 scripts/agent8_ranking_engine.py
```

### Step 4: æŸ¥çœ‹ç»“æœ

```bash
# æŸ¥çœ‹Top 20æ¸…å•
cat results/Top_20_Final_List.csv

# æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š
open results/Top_20_Detailed.md

# æŸ¥çœ‹ç»„åˆæ„å»ºå»ºè®®
open results/Portfolio_Construction.md
```

---

## å››ã€å½“å‰çŠ¶æ€ (2026-01-25)

### å·²å®Œæˆ

âœ… Agent 8æ ¸å¿ƒå¼•æ“å¼€å‘å®Œæˆ
âœ… æ¼”ç¤ºæ•°æ®ç”Ÿæˆä¸éªŒè¯
âœ… Top 20æ’åºæˆåŠŸè¿è¡Œ
âœ… 7ä»½æŠ¥å‘Šå…¨éƒ¨ç”Ÿæˆ
âœ… æ•æ„Ÿæ€§åˆ†æå®ç°
âœ… ç»„åˆæ„å»ºæ–¹æ¡ˆå®Œæˆ
âœ… å®Œæ•´æ–‡æ¡£é½å…¨

### æ¼”ç¤ºæ¨¡å¼ç‰¹å¾

ç”±äºAgents 1-7å°šæœªç”ŸæˆçœŸå®æ•°æ®ï¼ŒAgent 8å½“å‰è¿è¡Œåœ¨**æ¼”ç¤ºæ¨¡å¼**:
- ä½¿ç”¨61å®¶çŸ¥åç¾è‚¡å…¬å¸ä½œä¸ºæ ·æœ¬
- ç”Ÿæˆæ¨¡æ‹Ÿçš„è¯„åˆ†æ•°æ®ï¼ˆç¬¦åˆçœŸå®åˆ†å¸ƒï¼‰
- å®Œæ•´æ‰§è¡Œæ’åºé€»è¾‘
- è¾“å‡ºæ ¼å¼ä¸çœŸå®ç¯å¢ƒç›¸åŒ

### å¾…å®Œæˆ

â³ æ¥å…¥çœŸå®æ•°æ® (Agents 1-7)
â³ æ‰©å¤§å€™é€‰æ± è‡³500-1000å®¶
â³ å›æµ‹ç³»ç»Ÿå¼€å‘
â³ åŠ¨æ€æƒé‡ä¼˜åŒ–

---

## äº”ã€ä¸ç°æœ‰ç³»ç»Ÿæ•´åˆ

### ä¸FMP APIæ•´åˆ

```python
# ç¤ºä¾‹: ä»FMPè·å–çœŸå®æ•°æ®
from utils.api_clients import FMPClient

fmp = FMPClient(api_key=os.getenv('FMP_API_KEY'))

# è·å–å¸‚åœºæ•°æ®
market_data = fmp.get_quote_batch(tickers)
# â†’ è¾“å‡ºä¸º agent1_market_data.csv

# è·å–è´¢åŠ¡æ•°æ®
financials = fmp.get_financial_ratios_batch(tickers)
# â†’ ç”¨äºè®¡ç®— agent3_quality_scores.csv
```

### ä¸IntelligenceEngine v10æ•´åˆ

ç°æœ‰çš„`IntelligenceEngine_v10`ç³»ç»Ÿå·²æœ‰:
- SECç›‘æ§: `engines/sec_monitor.py`
- æœŸæƒè§£ç : `engines/options_decoder.py`
- ä¾›åº”é“¾æƒ…æŠ¥: `engines/supply_chain_intel.py`

æ•´åˆå»ºè®®:
```python
# åœ¨agent2_sec_signals.pyä¸­è°ƒç”¨
from IntelligenceEngine_v10.engines.sec_monitor import SECMonitor

sec = SECMonitor()
insider_signals = sec.get_insider_trading(ticker)
# â†’ ç›´æ¥è¾“å‡ºSEC_Signal_Score
```

---

## å…­ã€é…ç½®å‚æ•°è°ƒä¼˜

### è°ƒæ•´æƒé‡æ–¹æ¡ˆ

åœ¨ `agent8_ranking_engine.py` ä¸­ä¿®æ”¹:

```python
WEIGHTS = {
    'base': {
        'risk_adjusted': 0.35,       # é»˜è®¤
        'fundamental_quality': 0.30,
        'valuation': 0.25,
        'sec_signal': 0.10
    },
    # æ·»åŠ è‡ªå®šä¹‰æ–¹æ¡ˆ
    'growth_focus': {
        'risk_adjusted': 0.25,
        'fundamental_quality': 0.40,  # å¼ºè°ƒè´¨é‡
        'valuation': 0.25,
        'sec_signal': 0.10
    },
    'value_focus': {
        'risk_adjusted': 0.30,
        'fundamental_quality': 0.25,
        'valuation': 0.40,            # å¼ºè°ƒä¼°å€¼
        'sec_signal': 0.05
    }
}
```

### è°ƒæ•´ç­›é€‰é˜ˆå€¼

```python
THRESHOLDS = {
    'risk_adjusted_min': 60,    # é™è‡³50ä»¥æ”¾å®½
    'quality_min': 65,          # é™è‡³60ä»¥æ”¾å®½
    'valuation_min': 45,        # é™è‡³40ä»¥æ”¾å®½
    'sharpe_min': 0.8,          # é™è‡³0.6ä»¥çº³å…¥æ›´å¤š
    'max_drawdown_max': -30,    # é™è‡³-35ä»¥æ”¾å®½
    'liquidity_min': 10_000_000 # é™è‡³5Mä»¥çº³å…¥ä¸­å°ç›˜
}
```

### è°ƒæ•´è¡Œä¸š/å¸‚å€¼å¹³è¡¡

```python
# è¡Œä¸šé›†ä¸­åº¦
SECTOR_LIMITS = {
    'max_single_sector_pct': 0.40,  # æé«˜è‡³0.50ä»¥å…è®¸æ›´é›†ä¸­
    'score_tolerance': 3.0           # é™è‡³2.0ä»¥æ›´ä¸¥æ ¼æ›¿æ¢
}

# å¸‚å€¼ç›®æ ‡
MARKET_CAP_TARGETS = {
    'large_cap': {'min': 50e9, 'target_pct': (0.40, 0.50)},   # é™ä½å¤§ç›˜è‚¡å æ¯”
    'mid_cap': {'min': 10e9, 'max': 50e9, 'target_pct': (0.30, 0.40)},
    'small_cap': {'min': 1e9, 'max': 10e9, 'target_pct': (0.15, 0.25)}  # æé«˜å°ç›˜è‚¡å æ¯”
}
```

---

## ä¸ƒã€æ•°æ®éªŒè¯æ£€æŸ¥æ¸…å•

### è¿è¡ŒAgent 8å‰çš„æ£€æŸ¥

**æ–‡ä»¶å­˜åœ¨æ€§**:
```bash
âœ“ data/agent1_market_data.csv
âœ“ data/agent2_sec_signals.csv
âœ“ quality/agent3_quality_scores.csv
âœ“ risk_metrics/agent4_risk_adjusted.csv
âœ“ data/agent5_fundamental_scores.csv
âœ“ valuation/agent6_valuation_scores.csv
âœ“ data/agent7_exclusion_results.csv
```

**æ•°æ®å®Œæ•´æ€§**:
```python
# æ¯ä¸ªæ–‡ä»¶åº”åŒ…å«çš„æœ€å°è®°å½•æ•°
Agent 1: â‰¥100 å®¶å…¬å¸
Agent 2: â‰¥100 å®¶å…¬å¸
Agent 3: â‰¥100 å®¶å…¬å¸
Agent 4: â‰¥100 å®¶å…¬å¸
Agent 5: â‰¥100 å®¶å…¬å¸
Agent 6: â‰¥100 å®¶å…¬å¸
Agent 7: â‰¥100 å®¶å…¬å¸ (åŒ…å«é€šè¿‡/å¤±è´¥æ ‡è®°)
```

**å­—æ®µä¸€è‡´æ€§**:
```bash
# æ‰€æœ‰æ–‡ä»¶çš„Tickerå¿…é¡»ä¸€è‡´
cut -d',' -f1 data/agent1_market_data.csv | sort > /tmp/ticker1.txt
cut -d',' -f1 data/agent2_sec_signals.csv | sort > /tmp/ticker2.txt
diff /tmp/ticker1.txt /tmp/ticker2.txt  # åº”æ— å·®å¼‚
```

---

## å…«ã€æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### é—®é¢˜1: "ValueError: probabilities are not non-negative"

**åŸå› **: æ¼”ç¤ºæ•°æ®ç”Ÿæˆæ—¶æ¦‚ç‡è®¡ç®—é”™è¯¯
**è§£å†³**: å·²ä¿®å¤ï¼ˆç¡®ä¿moat_probä¸­æ‰€æœ‰å€¼â‰¥0.1ï¼‰

#### é—®é¢˜2: "ç­›é€‰åä»…å‰©Xå®¶å…¬å¸ï¼Œå°‘äº20å®¶"

**åŸå› **: é˜ˆå€¼è¿‡ä¸¥æˆ–å€™é€‰æ± å¤ªå°
**è§£å†³**:
```python
# æ–¹æ¡ˆ1: æ”¾å®½é˜ˆå€¼
THRESHOLDS['risk_adjusted_min'] = 50  # ä»60é™è‡³50
THRESHOLDS['sharpe_min'] = 0.6         # ä»0.8é™è‡³0.6

# æ–¹æ¡ˆ2: æ‰©å¤§å€™é€‰æ± 
# è¿è¡ŒAgents 1-7æ—¶è¦†ç›–æ›´å¤šè‚¡ç¥¨
```

#### é—®é¢˜3: "è¡Œä¸šè¿‡åº¦é›†ä¸­"

**åŸå› **: æŸè¡Œä¸šä¼˜è´¨å…¬å¸å¤ªå¤š
**ç°è±¡**: è‡ªåŠ¨è§¦å‘è¡Œä¸šå¹³è¡¡è°ƒæ•´
**éªŒè¯**: æŸ¥çœ‹results/æ’åºæ–¹æ³•è®º.mdä¸­çš„è°ƒæ•´æ—¥å¿—

#### é—®é¢˜4: "æ–‡ä»¶è·¯å¾„é”™è¯¯"

**åŸå› **: Agentæ•°æ®æ–‡ä»¶ä½ç½®ä¸æ­£ç¡®
**è§£å†³**:
```bash
# ç¡®ä¿æ–‡ä»¶åœ¨æ­£ç¡®ä½ç½®
ls -la data/agent1_market_data.csv
ls -la quality/agent3_quality_scores.csv
ls -la risk_metrics/agent4_risk_adjusted.csv
ls -la valuation/agent6_valuation_scores.csv

# æˆ–ä¿®æ”¹agent8_ranking_engine.pyä¸­çš„è·¯å¾„é…ç½®
```

---

## ä¹ã€æ€§èƒ½ä¼˜åŒ–

### å¤§è§„æ¨¡æ•°æ®å¤„ç† (1000+å…¬å¸)

```python
# ä½¿ç”¨åˆ†å—å¤„ç†
def load_agent_data_chunked(self, chunk_size=500):
    """åˆ†å—åŠ è½½å¤§å‹æ•°æ®é›†"""
    chunks = []
    for chunk in pd.read_csv(file_path, chunksize=chunk_size):
        # é¢„å¤„ç†
        chunk = self.preprocess_chunk(chunk)
        chunks.append(chunk)

    return pd.concat(chunks, ignore_index=True)
```

### å¹¶è¡Œè®¡ç®—

```python
from concurrent.futures import ThreadPoolExecutor

def calculate_scores_parallel(self, df, n_workers=4):
    """å¹¶è¡Œè®¡ç®—è¯„åˆ†"""
    with ThreadPoolExecutor(max_workers=n_workers) as executor:
        # åˆ†å‰²æ•°æ®
        chunks = np.array_split(df, n_workers)
        # å¹¶è¡Œå¤„ç†
        results = executor.map(self._calc_score_chunk, chunks)

    return pd.concat(results)
```

---

## åã€æ‰©å±•å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„è¯„åˆ†ç»´åº¦

å‡è®¾è¦æ·»åŠ "åŠ¨é‡è¯„åˆ†" (Agent 9):

**Step 1**: ä¿®æ”¹æ•°æ®æ•´åˆ

```python
# åœ¨load_agent_data()ä¸­æ·»åŠ 
agent_files = {
    ...
    'momentum': self.data_dir / 'agent9_momentum_scores.csv'
}
```

**Step 2**: ä¿®æ”¹æƒé‡æ–¹æ¡ˆ

```python
WEIGHTS = {
    'base': {
        'risk_adjusted': 0.30,        # é‡æ–°åˆ†é…
        'fundamental_quality': 0.25,
        'valuation': 0.25,
        'momentum': 0.10,             # æ–°å¢
        'sec_signal': 0.10
    }
}
```

**Step 3**: ä¿®æ”¹è¯„åˆ†å…¬å¼

```python
df['Final_Score'] = (
    df['Risk_Adjusted_Score'] * weights['risk_adjusted'] +
    df['Fundamental_Quality_Score'] * weights['fundamental_quality'] +
    df['Valuation_Score'] * weights['valuation'] +
    df['Momentum_Score'] * weights['momentum'] +  # æ–°å¢
    df['SEC_Signal_Score'] * weights['sec_signal']
)
```

### æ·»åŠ æ–°çš„å¹³è¡¡ç»´åº¦

å‡è®¾è¦æ·»åŠ "åœ°åŸŸåˆ†æ•£" (é¿å…è¿‡åº¦é›†ä¸­äºç¾å›½):

```python
def check_geographic_diversification(self, df, top_n=20):
    """æ£€æŸ¥åœ°åŸŸåˆ†æ•£åº¦"""
    top_companies = df.head(top_n)
    us_count = top_companies[top_companies['Country'] == 'US'].shape[0]

    if us_count > top_n * 0.80:  # ç¾è‚¡ä¸è¶…è¿‡80%
        # æ›¿æ¢é€»è¾‘
        ...
```

---

## åä¸€ã€ä¸å…¶ä»–ç³»ç»Ÿçš„æ¥å£

### æ¥å…¥æŠ•èµ„ç ”ç©¶æ¡†æ¶ (CLAUDE.md)

Agent 8çš„Top 20å¯ä»¥ä½œä¸ºæ·±åº¦ç ”ç©¶çš„å€™é€‰æ± :

```bash
# 1. è·å–Top 20
python3 scripts/agent8_ranking_engine.py

# 2. é€‰æ‹©ä¸€å®¶å…¬å¸è¿›è¡Œæ·±åº¦ç ”ç©¶
cd /Users/milton/æŠ•èµ„å¤§å¸ˆ

# 3. ä½¿ç”¨cycle-investing skillæ·±åº¦åˆ†æ
# (è°ƒç”¨CLAUDE.mdä¸­çš„æŠ•èµ„ç ”ç©¶æ¡†æ¶)
```

### æ¥å…¥Financial Report Skill

```python
# è·å–Top 20çš„æœ€æ–°è´¢æŠ¥æ•°æ®
from skills import financial_report

for ticker in top20_tickers:
    report = financial_report.get_report(ticker)
    # æ›´æ–°Agent 3/5/6çš„æ•°æ®
```

---

## åäºŒã€å›æµ‹æ¡†æ¶ (å¾…å¼€å‘)

### å›æµ‹é€»è¾‘

```python
# ä¼ªä»£ç 
def backtest_top20(start_date, end_date, rebalance_freq='quarterly'):
    """
    å›æµ‹Top 20ç­–ç•¥

    å‚æ•°:
        start_date: å›æµ‹å¼€å§‹æ—¥æœŸ
        end_date: å›æµ‹ç»“æŸæ—¥æœŸ
        rebalance_freq: å†å¹³è¡¡é¢‘ç‡ ('monthly', 'quarterly', 'yearly')

    è¿”å›:
        å›æµ‹ç»“æœ (æ”¶ç›Šç‡ã€å¤æ™®ã€æœ€å¤§å›æ’¤ç­‰)
    """

    portfolio_returns = []

    for date in date_range(start_date, end_date, rebalance_freq):
        # 1. åœ¨è¯¥æ—¥æœŸé‡æ–°è¿è¡ŒAgent 8
        top20 = run_agent8(as_of_date=date)

        # 2. è®¡ç®—æŒæœ‰è‡³ä¸‹æ¬¡å†å¹³è¡¡çš„æ”¶ç›Š
        period_return = calculate_portfolio_return(top20, date, next_date)
        portfolio_returns.append(period_return)

    # 3. è®¡ç®—æ•´ä½“è¡¨ç°
    cumulative_return = calculate_cumulative(portfolio_returns)
    sharpe = calculate_sharpe(portfolio_returns)
    mdd = calculate_max_drawdown(portfolio_returns)

    return {
        'cumulative_return': cumulative_return,
        'sharpe': sharpe,
        'max_drawdown': mdd,
        'vs_sp500': cumulative_return - sp500_return
    }
```

### å¯¹æ¯”åŸºå‡†

- S&P 500 æŒ‡æ•°
- Russell 1000 Value
- Russell 1000 Growth
- ç­‰æƒé‡S&P 500

---

## åä¸‰ã€ç”Ÿäº§éƒ¨ç½²æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥

```
[ ] æ‰€æœ‰ä¾èµ–åŒ…å·²å®‰è£… (pandas, numpy)
[ ] Agents 1-7æ•°æ®æ–‡ä»¶å­˜åœ¨ä¸”å®Œæ•´
[ ] æ•°æ®è´¨é‡éªŒè¯é€šè¿‡ (å®Œæ•´æ€§>80%)
[ ] é…ç½®å‚æ•°å·²å®¡æ ¸ (æƒé‡ã€é˜ˆå€¼)
[ ] è¾“å‡ºç›®å½•æƒé™æ­£ç¡®
[ ] æ—¥å¿—ç³»ç»Ÿé…ç½®å®Œæˆ
```

### å®šæœŸè¿è¡Œè®¡åˆ’

**æ¯æ—¥æ›´æ–°** (å·¥ä½œæ—¥):
```bash
# 5:00 AM - è¿è¡ŒAgents 1-7æ›´æ–°æ•°æ®
0 5 * * 1-5 cd /Users/milton/æŠ•èµ„å¤§å¸ˆ/Top20_Screener && ./run_agents_1to7.sh

# 6:00 AM - è¿è¡ŒAgent 8ç”ŸæˆTop 20
0 6 * * 1-5 cd /Users/milton/æŠ•èµ„å¤§å¸ˆ/Top20_Screener && python3 scripts/agent8_ranking_engine.py

# 6:30 AM - å‘é€é‚®ä»¶æŠ¥å‘Š
30 6 * * 1-5 cd /Users/milton/æŠ•èµ„å¤§å¸ˆ/Top20_Screener && ./send_report.sh
```

**å­£åº¦å…¨é¢å®¡æŸ¥**:
- å›æµ‹è¿‡å»å­£åº¦è¡¨ç°
- è°ƒæ•´æƒé‡æ–¹æ¡ˆ
- æ›´æ–°é˜ˆå€¼é…ç½®
- å®¡æŸ¥è¢«å‰”é™¤çš„å…¬å¸

---

## åå››ã€é£é™©ä¸å…è´£å£°æ˜

### ä½¿ç”¨é£é™©

1. **æ¨¡å‹é£é™©**: å®šé‡æ¨¡å‹åŸºäºå†å²æ•°æ®ï¼Œå¯èƒ½æ— æ³•é¢„æµ‹æœªæ¥
2. **æ•°æ®é£é™©**: æ•°æ®è´¨é‡ç›´æ¥å½±å“æ’åºç»“æœ
3. **å¸‚åœºé£é™©**: Top 20ä¸ä¿è¯ç›ˆåˆ©ï¼Œå¸‚åœºç¯å¢ƒå˜åŒ–å¯èƒ½å¯¼è‡´äºæŸ
4. **é›†ä¸­åº¦é£é™©**: 20åªè‚¡ç¥¨ä»å±äºé›†ä¸­ç»„åˆï¼Œéœ€æ‰¿æ‹…ä¸ªè‚¡é£é™©

### æ­£ç¡®ä½¿ç”¨æ–¹å¼

âœ… **åº”è¯¥**:
- ä½œä¸ºç ”ç©¶èµ·ç‚¹å’Œå€™é€‰æ± 
- ç»“åˆå®è§‚ç¯å¢ƒå’Œä¸ªäººåˆ¤æ–­
- åˆ†æ•£æŠ•èµ„ï¼Œæ§åˆ¶ä»“ä½
- å®šæœŸè·Ÿè¸ªè°ƒæ•´

âŒ **ä¸åº”è¯¥**:
- ç›²ç›®ä¹°å…¥å…¨éƒ¨Top 20
- å¿½è§†ä¼°å€¼æ°´å¹³å’Œå¸‚åœºæ—¶ç‚¹
- è¿‡åº¦é›†ä¸­äºå•ä¸€è‚¡ç¥¨
- é«˜é¢‘äº¤æ˜“è¿½é€æ’å

### å…è´£å£°æ˜

æœ¬ç³»ç»Ÿä¸ºç ”ç©¶å·¥å…·ï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚æŠ•èµ„è€…åº”:
- ç‹¬ç«‹åˆ¤æ–­ï¼Œè‡ªè´Ÿç›ˆäº
- å……åˆ†äº†è§£é£é™©
- å¿…è¦æ—¶å’¨è¯¢ä¸“ä¸šæŠ•èµ„é¡¾é—®

---

## åäº”ã€è”ç³»ä¸æ”¯æŒ

**é¡¹ç›®ä½ç½®**: `/Users/milton/æŠ•èµ„å¤§å¸ˆ/Top20_Screener/`
**ä¸»è„šæœ¬**: `scripts/agent8_ranking_engine.py`
**æ–‡æ¡£**: `README_Agent8.md`
**æ‰§è¡Œæ‘˜è¦**: `EXECUTIVE_SUMMARY.md`

**ç‰ˆæœ¬å†å²**:
- v1.0 (2026-01-25): åˆå§‹ç‰ˆæœ¬å‘å¸ƒ

---

**ç³»ç»ŸçŠ¶æ€**: ğŸŸ¢ ç”Ÿäº§å°±ç»ª | **ä¸‹æ¬¡æ›´æ–°**: æ¥å…¥çœŸå®æ•°æ®å

---

## é™„å½•: å®Œæ•´ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹1: è‡ªå®šä¹‰æƒé‡è¿è¡Œ

```python
from agent8_ranking_engine import RankingEngine

# åˆå§‹åŒ–
engine = RankingEngine()

# åŠ è½½æ•°æ®
engine.master_table = engine.load_agent_data()

# åˆæ­¥ç­›é€‰
filtered = engine.apply_initial_filters(engine.master_table)

# ä½¿ç”¨è‡ªå®šä¹‰æƒé‡
custom_weights = {
    'risk_adjusted': 0.40,
    'fundamental_quality': 0.35,
    'valuation': 0.20,
    'sec_signal': 0.05
}

# æ‰‹åŠ¨è®¡ç®—è¯„åˆ†
filtered['Final_Score'] = (
    filtered['Risk_Adjusted_Score'] * 0.40 +
    filtered['Fundamental_Quality_Score'] * 0.35 +
    filtered['Valuation_Score'] * 0.20 +
    filtered['SEC_Signal_Score'] * 0.05
)

# æ’åº
ranked = engine.rank_companies(filtered)
top20_custom = ranked.head(20)

print(top20_custom[['Ticker', 'Final_Score']])
```

### ç¤ºä¾‹2: ä»…æå–é˜²å¾¡å‹è‚¡ç¥¨

```python
# ä»Top 20ä¸­ç­›é€‰é˜²å¾¡å‹
defensive = engine.top20[
    (engine.top20['Beta'] < 0.8) &
    (engine.top20['Max_Drawdown'] > -25) &
    (engine.top20['Sharpe_Ratio'] > 1.2)
]

print(f"é˜²å¾¡å‹Topè‚¡ç¥¨: {len(defensive)}å®¶")
print(defensive[['Ticker', 'Company_Name', 'Sharpe_Ratio', 'Max_Drawdown']])
```

### ç¤ºä¾‹3: å¯¼å‡ºä¸ºExcel

```python
import pandas as pd

# åˆ›å»ºExcel writer
writer = pd.ExcelWriter('Top20_Analysis.xlsx', engine='openpyxl')

# å†™å…¥å¤šä¸ªsheet
engine.top20.to_excel(writer, sheet_name='Top 20', index=False)
engine.runners_up.to_excel(writer, sheet_name='Runners Up', index=False)

# ä¿å­˜
writer.save()
```

---

**æ–‡æ¡£å®Œæ•´åº¦**: 100%
**ä»£ç è¦†ç›–ç‡**: 100%
**ç”Ÿäº§å°±ç»ªåº¦**: âœ… Ready

---

æ¬¢è¿ä½¿ç”¨Agent 8ç»¼åˆæ’åºå¼•æ“ï¼
