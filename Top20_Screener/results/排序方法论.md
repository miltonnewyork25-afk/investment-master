# Agent 8: 综合排序引擎方法论

## 数据整合流程

```
Agent 1: 市场数据库 → Sharpe, Beta, 价格数据
Agent 2: SEC信号 → 内部人买入, 机构持仓
Agent 3: 质量指标 → 现金流, ROIC, 护城河
Agent 4: 风险调整 → Sharpe, MDD, Sortino
Agent 5: 基本面质量 → 0-100评分
Agent 6: 估值 → 低估程度, DCF上涨空间
Agent 7: 排除规则 → 通过/失败

↓ 合并为主数据表 (Company_Master_Table)
```

## 筛选阈值

```python
THRESHOLDS = {
    'risk_adjusted_min': 60,
    'quality_min': 65,
    'valuation_min': 45,
    'sharpe_min': 0.8,
    'max_drawdown_max': -30,
    'liquidity_min': 10000000,
}
```

## 综合评分公式

### 基准权重

```
Final_Score = 
  Risk_Adjusted_Score × 35% +
  Fundamental_Quality_Score × 30% +
  Valuation_Score × 25% +
  SEC_Signal_Score × 10%
```

**权重理由**:  
- 35% 风险调整收益: 核心要求 (Sharpe + 尾部风险)  
- 30% 基本面质量: 护城河 + 现金流 + 资本效率  
- 25% 估值: 被低估程度  
- 10% SEC信号: 内部人/机构增持 (辅助验证)  

## 排序逻辑

```python
排序步骤:
1. 按Final_Score从高到低排序
2. 相同分数时:
   a. Risk_Adjusted_Score更高的优先 (安全第一)
   b. 仍相同, Fundamental_Quality更高的优先
   c. 仍相同, 市值更大的优先 (流动性)
3. 取Top 20
```

## 行业分散度调整

**目标**: 避免单一行业占比 > 40%  

**调整规则**:  
- 如果某行业占比过高  
- 替换最低分的同行业公司  
- 换入其他行业中评分最高的公司  
- 但: 只有分数差距 < 3.0分时才替换 (不牺牲质量)  

## 市值分散度目标

```
Large Cap (>$50B):   50-60%
Mid Cap ($10-50B):   30-40%
Small Cap ($1-10B):  10-20%
```

## 质量验证清单

```
[ ] 所有公司通过Agent 7排除规则
[ ] 所有公司Risk_Adjusted_Score ≥ 60
[ ] 所有公司Fundamental_Quality ≥ 65
[ ] 所有公司Valuation_Score ≥ 45
[ ] 平均Sharpe Ratio ≥ 1.0
[ ] 平均MDD < -30%
[ ] 行业分散 (单行业<40%)
[ ] 市值分散 (大中小盘都有)
[ ] 流动性充足 (日交易量>$10M)
[ ] 数据完整性 >80%
```
