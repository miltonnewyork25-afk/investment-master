# 三段式漏斗方法论

**版本**: 1.0
**日期**: 2026-01-26
**作者**: Agent 12 - 聪明钱候选池构建器

---

## 1. 核心设计原则

### 1.1 问题定义

传统筛选方法的问题:
- 从3000+只美股穷举筛选，效率极低
- 每只股票都做深度分析，时间成本高
- 容易遗漏"隐藏的好公司"

### 1.2 解决方案

**用监管披露数据（N-PORT/13F）快速构建高质量候选池，替代全局穷举**

核心逻辑:
1. 不是从3000只美股筛选 → 而是从"顶级基金已经买了什么"开始
2. 用"已被验证的持仓数据"做候选池，比读文章快一个数量级
3. 候选池直接缩小到200-300只高质量股票
4. "深阅读"只发生在20-30家公司，而不是200-2000家

---

## 2. 数据源

### 2.1 N-PORT（公募基金持仓）

| 属性 | 说明 |
|------|------|
| 来源 | SEC EDGAR N-PORT XML数据 |
| 内容 | 公募基金月度持仓 |
| 披露节奏 | 按月报送，按季度公开（滞后约60天） |
| 价值 | 看到表现最好的公募基金在买什么 |

**目标基金（表现最优的价值型/质量型基金）**:

| 类型 | 基金名称 |
|------|----------|
| 大盘价值 | Vanguard Value Index Fund |
| 大盘价值 | Fidelity Value Discovery Fund |
| 大盘价值 | Dodge & Cox Stock Fund |
| 大盘价值 | T. Rowe Price Value Fund |
| 质量增长 | Fidelity Contrafund |
| 质量增长 | T. Rowe Price Blue Chip Growth |
| 股息增长 | Vanguard Dividend Growth Fund |
| 股息增长 | T. Rowe Price Dividend Growth |

### 2.2 Form 13F（机构持仓）

| 属性 | 说明 |
|------|------|
| 来源 | SEC EDGAR 13F文件 |
| 内容 | 机构持仓（管理资产>$100M的机构必须披露） |
| 披露节奏 | 季度后45天内 |
| 价值 | 看到Berkshire、Bridgewater等顶级机构在买什么 |

**目标机构**:

| 机构 | 风格 | 权重 |
|------|------|------|
| Berkshire Hathaway | Value | 10 |
| Bridgewater Associates | Macro | 9 |
| Pershing Square | Activist | 9 |
| Baupost Group | Value | 9 |
| Druckenmiller | Macro | 9 |
| Third Point | Activist | 8 |
| ValueAct Capital | Activist | 8 |
| Tiger Global | Growth | 8 |
| Renaissance Technologies | Quant | 7 |
| Two Sigma | Quant | 7 |

---

## 3. 三段式漏斗架构

```
┌────────────────────────────────────────────────────────────────────────┐
│                     Stage 1: 候选池筛选                                  │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  输入: 聪明钱持仓 (N-PORT公募 + 13F机构)                           │   │
│  │  过滤: 硬指标 (Sharpe >= 0.3, MDD >= -50%, 行业排除)              │   │
│  │  输出: ~150-200只                                                 │   │
│  │  速度: 极快 (仅用量化指标)                                          │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌────────────────────────────────────────────────────────────────────────┐
│                     Stage 2: 排序筛选                                   │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  输入: Stage 1 通过者 (~150-200只)                                │   │
│  │  方法: 基本面指标面板 + 综合评分                                   │   │
│  │  输出: Top 50                                                     │   │
│  │  速度: 中等 (基本面计算)                                           │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌────────────────────────────────────────────────────────────────────────┐
│                     Stage 3: 证据链核验                                  │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  输入: Top 50                                                     │   │
│  │  方法: 完整证据链 (10-K/10-Q/8-K/IR/电话会)                       │   │
│  │  输出: Top 20                                                     │   │
│  │  速度: 最慢 (深度阅读), 但只对30-50家做                            │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 各阶段详解

### 4.1 Stage 1: 候选池筛选

**输入**: 聪明钱候选池 (~300只)
- N-PORT: 被2+家优秀公募基金持有
- 13F: 被2+家顶级机构持有

**硬指标过滤**:

| 指标 | 阈值 | 说明 |
|------|------|------|
| Sharpe Ratio | >= 0.3 | 3年风险调整收益 |
| Max Drawdown | >= -50% | 宽松阈值，Stage 2再收紧 |
| 行业排除 | 烟草、博彩 | ESG考量 |
| 数据完整 | 必须 | 确保可分析 |

**输出**: ~150-200只
**速度**: 极快（秒级）

### 4.2 Stage 2: 排序筛选

**输入**: Stage 1通过者 (~150-200只)

**综合评分公式**:

```
Composite Score =
  Sharpe_Score × 30% +        # Sharpe贡献
  Tail_Risk_Score × 15% +     # 尾部风险(MDD)贡献
  Fundamental_Score × 25% +   # 基本面贡献
  Valuation_Score × 20% +     # 估值贡献
  SEC_Signal_Score × 10%      # SEC信号贡献
```

**各维度得分计算**:

| 维度 | 计算方法 |
|------|----------|
| Sharpe Score | Sharpe 0→0, 0.5→30, 1.0→60, 2.0→100 |
| Tail Risk Score | MDD -10%→100, -20%→80, -30%→60, -50%→20 |
| Fundamental | ROIC、OCF/NI、利润率、负债率综合 |
| Valuation | FCF Yield、PE分位、同业对比 |
| SEC Signal | 内部人交易、机构动向、13D/13G |

**输出**: Top 50
**速度**: 中等（分钟级）

### 4.3 Stage 3: 证据链核验

**输入**: Top 50

**验证内容**:
1. 数据来源完整性（至少3/5个数据源）
2. 数据时效性（最新季度数据）
3. 关键假设验证

**数据源清单**:
- Risk Metrics (Sharpe/MDD)
- Fundamental Data
- Valuation Data
- SEC Signal Data
- Smart Money (N-PORT/13F)

**输出**: Top 20
**速度**: 最慢，但范围已缩小

---

## 5. Smart Money得分计算

```python
Smart Money Score =
  N-PORT持有基金数 × 5 +        # 公募持有
  13F持有机构数 × 10 +          # 机构持有（权重更高）
  信号强度 × 3 +                 # 最近新买入/加仓
  高权重持仓加分 × 5            # 基金中占比>2%
```

**信号强度计算**:
- NEW（新建仓）: +2
- INCREASED（加仓）: +1
- HELD（持平）: 0
- DECREASED（减仓）: -1

---

## 6. 排除规则

### 6.1 行业排除

| 行业 | 排除原因 |
|------|----------|
| 烟草 | ESG |
| 博彩 | ESG |
| （可选）军工 | ESG |

### 6.2 特定股票排除

```
烟草: PM, MO, BTI, JAPAY, TPB, VGR
博彩: LVS, WYNN, MGM, CZR, DKNG, PENN, BYD, BALY
```

---

## 7. 输出文件

| 文件 | 说明 |
|------|------|
| `smart_money_candidates.json` | 聪明钱候选池完整数据 |
| `smart_money_pool_report.md` | 候选池报告 |
| `smart_money_tickers.txt` | 候选池Ticker列表 |
| `funnel_top_20.csv` | 最终Top 20 |
| `funnel_report.json` | 完整JSON报告 |
| `funnel_results.md` | Markdown结果报告 |

---

## 8. 使用方法

### 8.1 独立运行

```bash
# 运行聪明钱候选池构建
python smart_money_pool.py

# 运行三段式漏斗
python three_stage_funnel.py
```

### 8.2 作为模块导入

```python
from funnel import ThreeStageFunnel

funnel = ThreeStageFunnel()
result = funnel.run_full_funnel()
funnel.export_results()

# 获取Top 20
top_20 = funnel.stage3_results
```

---

## 9. 数据更新频率

| 数据源 | 更新频率 | 滞后时间 |
|--------|----------|----------|
| N-PORT | 月度 | ~60天 |
| 13F | 季度 | ~45天 |
| 风险指标 | 日度 | 实时 |
| 基本面 | 季度 | ~1-2月 |
| SEC信号 | 实时 | ~1天 |

---

## 10. 局限性

1. **数据滞后**: N-PORT/13F数据有45-60天滞后，大型机构可能已调整持仓
2. **跟随策略**: 本质是"跟随聪明钱"，不是独立发现
3. **大盘偏好**: 顶级机构持仓偏向大盘股，可能遗漏小盘机会
4. **季度快照**: 无法捕捉日内交易策略

**缓解措施**:
- 结合实时SEC信号（8-K、Form 4）
- 保留部分独立筛选渠道
- 对Stage 3结果做深度研究验证

---

## 11. 后续优化方向

1. **N-PORT XML自动解析**: 完善CUSIP→Ticker映射
2. **13F持仓变化追踪**: 季度对比，识别趋势
3. **信号时效性加权**: 最近信号权重更高
4. **机器学习排序**: 用历史表现训练排序模型
5. **实时监控**: 新13F/N-PORT披露自动触发更新

---

**文档版本**: 1.0
**最后更新**: 2026-01-26
