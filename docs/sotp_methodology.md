# SOTP 分部估值方法论 v3.0

> **用途**: Tier 2/3 估值分析中，当公司有≥2个可独立估值的业务分部时使用。提供比单一PE/DCF更精确的估值。
> **v3.0变化**: 新增Step 6期权估值模块(OVM)，解决高期权公司(TSLA/PLTR/GOOGL)传统估值远低于市价的问题。
> **v2.0变化**: 新增工作底稿验证流程(三步验证)、估值修正层级引用、DM锚点集成。解决GOOGL SOTP段值偏差249%问题。

---

## 适用条件

| 条件 | 说明 |
|------|------|
| **强制使用** | 业务分部≥3个且增速差异>10ppt |
| **建议使用** | 业务分部≥2个且估值逻辑不同（如硬件+服务） |
| **不适用** | 纯单一业务公司（如纯SaaS、纯零售） |

---

## 标准流程（6步）

> Step 1-5: 传统分部估值 | Step 6: 期权估值叠加(OVM) — 仅高期权公司需要

### Step 1: 业务分部识别

从最新10-K/年报中提取分部数据：

```
输出格式:
| 分部 | 营收($B) | 占比 | 增速 | 营业利润率 | 可比公司 |
|------|---------|------|------|----------|---------|
| [分部A] | X.X | XX% | XX% | XX% | [COMP1, COMP2] |
| [分部B] | X.X | XX% | XX% | XX% | [COMP3, COMP4] |
```

**关键规则**:
- 分部划分以公司官方财报分部为基准
- 如官方分部过于笼统，可基于行业逻辑拆分（须注明"分析师拆分"）
- 每个分部必须有独立的营收和利润数据

### Step 2: 分部独立估值

对每个分部选择最合适的估值方法：

| 业务类型 | 首选估值法 | 备选估值法 | 关键倍数 |
|---------|----------|----------|---------|
| 高增长科技 | EV/Revenue → EV/EBITDA | DCF (高增长阶段) | Revenue倍数参考同行 |
| 成熟制造 | P/E + EV/EBITDA | 股息折现 | PE参考行业中位数 |
| 平台/生态 | EV/用户 + EV/Revenue | 期权定价（潜在市场） | 用户价值参考同类 |
| 周期性 | 正常化PE + P/B | 周期调整PE (CAPE) | 中周期正常化盈利 |
| 服务/订阅 | EV/ARR + DCF | LTV/CAC模型 | ARR倍数参考SaaS |

**分部估值卡模板**:
```
分部: [名称]
估值方法: [方法名]
关键假设:
  - 增速: XX% (理由: [xxx])
  - 利润率: XX% (理由: [xxx])
  - 估值倍数: XXx (可比公司中位数: XXx)
分部EPS贡献: $X.XX
分部估值: $X.XX/股 (= EPS × 倍数)
```

### Step 3: 三情景矩阵

对每个分部构建 Bull/Base/Bear 三个情景：

```
| 分部 | Bear | Base | Bull | 关键变量 |
|------|------|------|------|---------|
| [A]  | $XX  | $XX  | $XX  | [驱动因素] |
| [B]  | $XX  | $XX  | $XX  | [驱动因素] |
| [C]  | $XX  | $XX  | $XX  | [驱动因素] |
| 合计 | $XX  | $XX  | $XX  | |

概率加权:
  Bear (25%): $XX
  Base (50%): $XX
  Bull (25%): $XX
  → 概率加权公允价值: $XX
```

**情景假设规则**:
- Bear: 行业下行 + 公司特定风险触发 + 倍数收缩20-30%
- Base: 行业温和增长 + 管理层指引达成 + 当前倍数维持
- Bull: 行业上行 + 超预期执行 + 倍数扩张10-20%
- 概率分配默认: 25%/50%/25%，可根据周期位置调整

### Step 4: 极端压力测试

在三情景之外，增加1-2个极端场景：

```
极端压力测试:
  场景: [具体场景描述，如"AI投入完全失败"]
  概率: <10%
  影响:
    - 分部[A]: [具体影响]
    - 分部[B]: [具体影响]
  极端情景估值: $XXX/股
  当前价 vs 极端底: [±XX%]

  → 若当前价距极端底<20%: 风险收益比不佳
  → 若当前价距极端底>40%: 安全边际充足
```

**常见极端场景模板**:
- **科技公司**: AI投资完全失败 / 反垄断拆分 / 核心产品被替代
- **半导体**: 地缘冲突导致产能中断 / 技术路线被颠覆
- **消费品**: 核心品牌价值崩塌 / 健康安全丑闻
- **金融**: 系统性金融危机 / 重大信贷损失

### Step 5: 交叉验证

将SOTP估值与其他方法交叉验证：

```
估值方法汇总:
| 方法 | 估值 | 权重 | 说明 |
|------|------|------|------|
| SOTP | $XXX | 40% | 分部加总 |
| DCF | $XXX | 30% | 现金流折现 |
| 可比公司 | $XXX | 20% | 同行估值倍数 |
| 历史区间 | $XXX | 10% | 过去5年PE区间 |
| **加权公允价值** | **$XXX** | | |

偏离度检查:
  SOTP vs DCF: [±X%] — [>15%需要解释原因]
  SOTP vs 当前价: [±X%] — [正=低估, 负=高估]
  → 如果 SOTP vs 当前价 < -50%: 触发Step 6 OVM (强制)
```

### Step 6: 期权估值叠加 (OVM) — v3.0新增

**触发条件**: Step 5完成后，若传统估值(SOTP/DCF加权)低于当前市价50%以上，
或公司有≥2条pre-revenue业务线，强制进入OVM。

**完整方法论**: `docs/optionality_valuation.md`

**执行摘要**:

```
Step 6a: Core vs Option分离 — 识别哪些业务是Core(传统估值), 哪些是Option(期权定价)
Step 6b: Reverse DCF — 当前股价隐含什么预期？合理还是激进？
Step 6c: 期权树定价 — 每条期权: TAM × 市占率 × 利润率 × PE × 概率 × 折现
Step 6d: TAM天花板 — 所有Bull case最大值，当前价已定价多少？
Step 6e: 叙事追踪 — 市场在交易什么故事？证据vs反证
Step 6f: 衰减日历 — 每条期权的里程碑+错过后果
```

**输出**: Full Value = Core(Step 1-5) + Options(Step 6c), 替代Step 5的加权公允价值作为最终估值

```
最终估值方法汇总 (含OVM):
| 方法 | 估值 | 权重 | 说明 |
|------|------|------|------|
| Core SOTP | $XXX | 30% | 现有业务分部(Step 1-5) |
| Core DCF | $XXX | 20% | 现有业务现金流折现 |
| OVM期权合计 | $XXX | 30% | 期权树概率加权(Step 6c) |
| 可比公司 | $XXX | 10% | 同行估值倍数 |
| Reverse DCF校验 | — | — | 不计入权重，仅做合理性校验 |
| **Full Value** | **$XXX** | | Core + Options |

Reverse DCF校验: 市场隐含预期 [合理/偏乐观/激进/不现实]
TAM利用率: XX% — [安全/中性/偏贵/危险]
```

**不触发OVM时**: 仍用Step 5的4方法加权，无变化。

---

### Step 7: 六方法收敛 (v3.1新增 — TSM v2.0实证)

**用途**: Phase 5最终估值产出时，将所有可用估值方法收敛为一个加权目标价 + 置信区间。

**触发条件**: 所有Phase 5决策输出(Tier 3 Complete), 不论是否启用OVM。

**六方法标准**:

```
方法1: 传统SOTP/DCF加权 (Step 5)          → 权重25%
方法2: AI/增长调整值 (行业溢价叠加)          → 权重20%
方法3: 偏差修正值 (P4行为金融校准)           → 权重20%
方法4: Bear-adjusted中位数 (三情景概率加权)   → 权重15%
方法5: 综合加权公允 (多来源analyst consensus) → 权重10%
方法6: DCF概率加权 (异常值, 校验用)           → 权重10%
```

**验证标准** (TSM v2.0实证):
- 中位数 vs 加权偏差应 <5% → 高度可信
- 50%置信区间不超过±15% → 可行动
- 如果偏差>10% → 需要解释分歧原因

**输出格式**:
```
六方法收敛: $XXX/share (±Y%)
50%置信区间: $A — $B
80%置信区间: $C — $D
中位数: $M | 加权: $W | 偏差: Z%
```

**实证**: TSM中位$363 vs 加权$370, 偏差1.9% → 极高交叉验证。

---

## 数据质量要求

| 数据项 | 最低要求 | 首选来源 |
|--------|---------|---------|
| 分部营收 | 最近4季度累计 | 10-K/10-Q |
| 分部利润率 | 最近2年趋势 | 10-K/10-Q |
| 可比公司倍数 | ≥3家可比 | Capital IQ/Bloomberg/WebSearch |
| 增速假设 | 管理层指引+分析师共识 | 电话会议+分析师报告 |

---

## 行业适配参数

### 半导体
```yaml
特殊分部: AI加速器 vs 传统芯片 vs 封装
估值差异: AI相关分部PE溢价50-100% vs 传统分部
周期调整: 使用正常化盈利(中周期)，非峰值/谷值
额外测试: "AI需求完全消失"极端场景
```

### 消费品
```yaml
特殊分部: 核心品牌 vs 新兴品牌 vs 国际市场
品牌价值: 核心品牌可获5-10x P/E溢价
渠道拆分: DTC vs 批发 vs 电商（估值逻辑不同）
额外测试: "自有品牌替代"极端场景
```

### 金融
```yaml
特殊分部: 利息收入 vs 手续费 vs 交易 vs 财富管理
估值方法: P/B + 超额ROE模型
监管约束: 资本要求限制回报上限
额外测试: "2008级金融危机"极端场景
```

### 科技平台
```yaml
特殊分部: 广告 vs 云 vs 硬件 vs 订阅服务
平台效应: 生态系统协同溢价10-20%
用户价值: 按ARPU估值新兴市场分部
额外测试: "反垄断强制拆分"极端场景
OVM触发: AI期权(Copilot/Gemini/AI Agent) → 强制Step 6
```

### 生态科技 (v3.0新增)
```yaml
特殊分部: 核心能源设备 vs 储能 vs 软件服务 vs 未来业务(robotaxi/机器人)
OVM强制: TSLA/PLTR等多期权公司 → 必须Step 6全量
绿色溢价: E×V溢价仅应用于Core业务，Option独立定价
政策期权: 补贴/碳税变化本身可构成独立期权路径
额外测试: "补贴全面退坡+化石能源回归"极端场景
```

---

## 执行规则

1. **Tier 3 强制**: 多分部公司的 Tier 3 报告必须包含完整 SOTP（Step 1-5全做，触发条件满足时Step 6也做）
2. **Tier 2 简化**: Tier 2 报告做 Step 1-3，可跳过极端压力测试和交叉验证；OVM仅做OVM-1+OVM-2(Core分离+Reverse DCF)
3. **数据标注**: 每个估值假设必须标注来源 `[硬数据:]`/`[合理推断:]` + DM版本号
4. **敏感度表**: 至少对最大分部做2个关键变量的敏感度分析
5. **禁止**: 禁止只用单一PE估值多分部公司
6. **OVM强制** (v3.0): 传统估值<市价50%时，必须完成Step 6全部6组件，否则估值不完整

---

## 工作底稿验证流程 (v2.0新增)

> **来源**: GOOGL SOTP段值偏差249%的教训。详细验证规程见 `docs/anti_hallucination_protocol.md`

### 三步验证（Tier 3 强制）

每个SOTP估值必须附带工作底稿，经过三步验证：

**Step A: 段值验证** — 每个分部的营收/利润率/倍数均有明确来源
- 分部营收 → 来自 `[DM-FIN-xxx vN.N]`
- 估值倍数 → 来自≥3家可比公司真实数据
- 分部估值 = 公式可验算

**Step B: 汇总验证** — 各分部之和 = SOTP总值（无重复计算/无遗漏）
- 检查: Σ(分部估值) ± 净债务/现金 = 企业价值

**Step C: 每股验证** — 企业价值 / 稀释后股数 = 报告中的每股估值
- 稀释后股数来自 `[DM-MKT-xxx]`

**验证失败处理**: 任一步不通过 → SOTP标记为❌待修正，报告不得引用该估值

### 估值修正层级引用

当Phase 4需要修正SOTP估值时，必须走估值修正层级管道（详见 `docs/valuation_correction_hierarchy.md`）。禁止直接覆盖Phase 2的估值数字。

### 与Data Master的集成

- SOTP各分部估值完成后，写入 `DM-VAL-001` 锚点
- 后续Phase引用SOTP必须使用 `[DM-VAL-001 vN.N]`
- Phase 4修正SOTP → DM-VAL-001版本号递增 + 变更日志
