# 框架回测方法论：防作弊设计

> 目的：验证分析框架的有效性，同时防止"前视偏差"（Look-ahead Bias）

---

## 一、作弊风险识别

### AI回测的固有问题

作为AI，我的训练数据可能包含：
1. LRCX历史股价走势
2. 各时期的市场事件和结果
3. 事后分析和归因

**风险**：即使"假装"不知道未来，潜意识的知识可能影响判断。

### 防作弊措施

| 措施 | 实施方法 | 可验证性 |
|------|----------|----------|
| **数据锁定** | 只使用FMP API历史数据，不使用记忆 | ✅ API返回值可验证 |
| **机械化评分** | 严格按框架公式计算，不做主观调整 | ✅ 计算过程透明 |
| **先预测后验证** | 预测写入后，再获取实际结果 | ✅ 文档时间戳 |
| **盲测设计** | 每个时间点独立分析，不参考其他时点 | ⚠️ 难以完全保证 |

---

## 二、回测设计

### 测试时间点选择

| 时间点 | 选择原因 | 预期周期位置 |
|--------|----------|-------------|
| **2022-10-01** | Memory周期深度衰退 | 底部区域 |
| **2023-04-01** | 衰退末期/复苏初期 | 拐点附近 |
| **2023-10-01** | AI热潮带动复苏 | 上升初期 |
| **2024-04-01** | 周期中期 | 上升中期 |
| **2024-10-01** | 当前周期 | 上升后期? |

### 每个时间点的数据需求

```
1. 财务数据（截至该季度末）
   - 收入、毛利率、净利率、FCF
   - 资产负债表关键指标
   - 来源：FMP API historical statements

2. 估值数据（该日期收盘）
   - 股价、P/E、EV/EBITDA
   - 来源：FMP API historical price

3. 先行指标（需要外部搜索）
   - DRAM现货价格
   - Memory CAPEX动向
   - 来源：历史新闻搜索（有作弊风险）
```

### 评分标准（机械化）

为减少主观判断，定义量化规则：

```python
# 第0层：结构性（10%）- 基于周期位置
def score_structural(dram_yoy_change):
    if dram_yoy_change < -30%: return 3  # 深度衰退
    if dram_yoy_change < -10%: return 5  # 衰退
    if dram_yoy_change < 10%:  return 7  # 复苏
    if dram_yoy_change < 30%:  return 8  # 扩张
    return 9  # 过热

# 第1层：先行指标（25%）
def score_leading(dram_spot_mom, capex_guidance):
    score = 5  # 基准
    if dram_spot_mom > 5%:  score += 2
    if dram_spot_mom > 10%: score += 1
    if capex_guidance == "up": score += 2
    if dram_spot_mom < -5%: score -= 2
    return min(10, max(1, score))

# 第3层：财务深度（25%）
def score_financial(gross_margin, fcf_margin, z_score):
    score = 5
    if gross_margin > 45%: score += 2
    if fcf_margin > 25%:   score += 2
    if z_score > 3:        score += 1
    if gross_margin < 40%: score -= 2
    return min(10, max(1, score))

# 第4层：估值风险（15%）
def score_valuation(pe_ratio, pe_historical_median):
    if pe_ratio < pe_historical_median * 0.7: return 9  # 低估
    if pe_ratio < pe_historical_median * 1.0: return 7  # 合理
    if pe_ratio < pe_historical_median * 1.3: return 5  # 偏高
    if pe_ratio < pe_historical_median * 1.6: return 3  # 高估
    return 2  # 泡沫
```

### 预测输出格式

每个时间点输出：

```
时间点：YYYY-MM-DD
─────────────────────────
输入数据：
  - 股价：$XXX
  - 毛利率：XX%
  - P/E：XX
  - DRAM MoM：XX%

框架评分：
  - 第0层：X/10
  - 第1层：X/10
  - 第2层：X/10（默认5，缺乏实时数据）
  - 第3层：X/10
  - 第4层：X/10
  - 第5层：5/10（默认，缺乏数据）

加权总分：XX/100

预测：
  - 6个月方向：[涨/跌/平]
  - 置信度：[高/中/低]
  - 建议：[买入/持有/卖出]

═══════════════════════════
【此处锁定，下方为验证区】
═══════════════════════════

实际结果（6个月后）：
  - 实际股价：$XXX
  - 实际涨跌：XX%
  - 预测是否正确：[是/否]
```

---

## 三、核心限制声明

### 我无法完全消除的偏差

1. **知识污染**：我可能"知道"2022年底是周期底部
2. **后验选择**：选择的测试时间点可能受到结果知识影响
3. **参数调整**：框架参数可能已经被优化以适应历史

### 用户可验证的部分

1. ✅ FMP API返回的历史财务数据
2. ✅ 评分计算过程（机械化公式）
3. ✅ 预测与实际结果的对比

### 无法验证的部分

1. ❌ 我选择输入数据时是否受到未来知识影响
2. ❌ 我对"先行指标"的定性判断
3. ❌ 框架本身是否是事后拟合

---

## 四、诚实声明

**我必须承认**：

作为2025年5月前训练的AI，我确实"知道"：
- 2022年底是Memory周期底部
- 2023年AI热潮推动了半导体复苏
- LRCX股价从2022年低点大幅反弹

**这意味着**：

1. 我的回测无法做到真正的"盲测"
2. 回测结果可能存在系统性乐观偏差
3. 框架的真正有效性需要在**未来**（我不知道的时期）验证

**更诚实的做法**：

- 我将尽量机械化执行框架规则
- 透明展示所有输入数据和计算过程
- 让您判断我的推理是否受到未来知识影响
- **将2025年以后的预测作为真正的样本外测试**

---

## 五、回测执行计划

### Step 1: 获取历史数据
通过FMP API获取每个时间点的：
- 历史股价
- 历史财务报表
- 历史财务比率

### Step 2: 搜索当时的先行指标
搜索每个时间点的：
- "DRAM price October 2022"
- "Memory CAPEX guidance Q4 2022"

### Step 3: 机械化评分
严格按照上述公式计算

### Step 4: 记录预测
在查看后续走势前锁定预测

### Step 5: 验证结果
对比预测与实际

---

*方法论版本：1.0*
*设计日期：2026年1月22日*
