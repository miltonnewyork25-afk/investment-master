## v22.0 输出可读性规范

### 基础规范

| 规范 | 要求 | 说明 |
|------|------|------|
| **Mermaid图** | **≥10个(Tier 3) / ≥5个(Tier 2)**，按Phase必选清单执行 | 见下方必选清单 |
| **代码整洁** | 输出前检查格式 | 确保代码块完整、无乱码 |
| **层级清晰** | 使用标准Markdown层级 | H2/H3/H4层级分明 |
| **表格对齐** | 确保表格格式正确 | 列对齐、无断行 |
| **图后必解读** | 每张Mermaid图后必须有文字解读 | 图不能孤立存在 |

---

### Mermaid图必选清单 (Tier 3)

> 最低 10 张，按 Phase 分配。每张图必须有标题+图后解读段落。

#### Phase 1: 定位与生态 (≥2张)

| # | 图名 | Mermaid类型 | 可视化内容 | 必选/加选 |
|---|------|-----------|-----------|---------|
| M-01 | **产业链全景图** | `graph TD` | 上游供应商→公司核心→下游消费者/渠道 | 必选 |
| M-02 | **飞轮/增长引擎图** | `graph TD` | 核心增长循环+关键指标标注 | 必选 |
| M-02.5 | 生命周期定位图 | `graph LR` | 导入→成长→成熟→再加速的S曲线定位 | 加选 |

#### Phase 2: 财务与估值 (≥2张)

| # | 图名 | Mermaid类型 | 可视化内容 | 必选/加选 |
|---|------|-----------|-----------|---------|
| M-03 | **收入构成图** | `pie` | 分部/地区/产品线收入占比 | 必选 |
| M-04 | **估值方法论汇总图** | `graph LR` | SOTP→DCF→可比→概率加权→最终公允价值 | 必选 |
| M-04.5 | SOTP瀑布图 | `graph LR` | 各分部估值→加总→协同调整→SOTP终值 | 加选 |

#### Phase 3: 战略深度 (≥3张)

| # | 图名 | Mermaid类型 | 可视化内容 | 必选/加选 |
|---|------|-----------|-----------|---------|
| M-05 | **护城河雷达图** | `radar` | 多维护城河评分(品牌/规模/转换/成本/网络) | 必选 |
| M-06 | **竞争定位矩阵** | `quadrantChart` | X=利润率/效率, Y=增长/份额, 点=各竞对 | 必选 |
| M-07 | **五引擎雷达图** | `radar` | 周期/股权/聪明钱/市场信号/预测市场 | 必选 |
| M-07.5 | AI冲击矩阵 | `quadrantChart` | X=可能性, Y=影响度, 点=各业务线 | 加选 |

#### Phase 4: 对抗审查 (≥1张)

| # | 图名 | Mermaid类型 | 可视化内容 | 必选/加选 |
|---|------|-----------|-----------|---------|
| M-08 | **Bear Case决策树** | `graph TD` | 看空情景→触发条件→估值影响→概率加权 | 必选 |
| M-08.5 | 偏差修正前后对比 | `graph LR` | Phase 1-3原始值→Phase 4修正值→变化幅度 | 加选 |

#### Phase 5: 决策输出 (≥2张)

| # | 图名 | Mermaid类型 | 可视化内容 | 必选/加选 |
|---|------|-----------|-----------|---------|
| M-09 | **Kill Switch激活流程图** | `graph TD` | 触发条件→确认检查→动作(减仓/清仓/重评估) | 必选 |
| M-10 | **催化剂时间线** | `gantt` | 12个月关键事件(财报/监管/产品/宏观) | 必选 |
| M-10.5 | 仓位调整决策树 | `graph TD` | 财报结果→指标检查→仓位动作 | 加选 |

### 行业加选图

| 行业 | 额外必选图 | 类型 | 说明 |
|------|-----------|------|------|
| **消费品** | PPDA背离雷达 | `radar` | Price/Product/Distribution/Advertising四维评分 |
| **消费品** | 自有品牌囚徒困境 | `graph TD` | 供应商选择树→两条路径→零售商均有利 |
| **科技平台** | 平台生态协同图 | `graph TD` | 各产品/服务间的数据/用户/收入流动 |
| **科技平台** | 数据飞轮效率图 | `graph TD` | 用户→数据→产品→用户循环+收益递减标注 |
| **半导体** | 周期定位时钟 | `graph LR` | Layer -1到Layer 3的信号传导时间线 |
| **半导体** | 技术路线图 | `gantt` | 制程节点/产品世代的时间线 |
| **金融** | 风险多维雷达 | `radar` | 信用/市场/流动性/操作/监管五维风险 |

### Mermaid类型多样性要求

单份报告中**至少使用 4 种不同的 Mermaid 类型**：

| 类型 | 适用场景 | 难度 |
|------|---------|------|
| `graph TD/LR` | 流程/决策/产业链/飞轮 | 低 |
| `pie` | 收入/份额/构成拆解 | 低 |
| `gantt` | 时间线/催化剂/路线图 | 低 |
| `radar` | 多维评分/雷达对比 | 中 |
| `quadrantChart` | 竞争定位/BCG矩阵/冲击矩阵 | 中 |
| `sankey` | 价值流/收入流向 | 高(加分项) |

**COST v21回顾**: 7张图仅用了3种类型(graph/radar/gantt)，缺少pie和quadrantChart。

---

### 铁律 F: 质量不退步 (No Regression)

> v22.0 新增。每份新报告必须在关键指标上 ≥ 同行业上一份报告。

#### 适用范围

- Tier 3 深度研究报告(跨公司比较)
- 同一公司的版本迭代(如PG v19.5 → PG v22)

#### 回归检查指标

| # | 指标 | 检查方法 | 退步判定 |
|---|------|---------|---------|
| R-01 | 总字符数 | `wc -m` | 新报告 < 上一份的 90% |
| R-02 | 标注密度 | 标注数/万字符 | 新报告 < 上一份 - 5/万 |
| R-03 | 硬数据占比 | 硬数据标注/总标注 | 新报告 < 上一份 - 5pp |
| R-04 | Mermaid图数 | 计数 | 新报告 < 上一份 |
| R-05 | Mermaid类型数 | 不同类型计数 | 新报告 < 上一份 |
| R-06 | Kill Switch数 | 计数 | 新报告 < 上一份 |
| R-07 | 可验证预测数 | 计数 | 新报告 < 上一份 |
| R-08 | 数据表格数 | 计数 | 新报告 < 上一份 |
| R-09 | Bear Case数 | 计数 | 新报告 < 上一份 |
| R-10 | CQ数量 | 计数 | 新报告 < 上一份 |

#### 基准线 (当前最高水准)

| 指标 | COST v21 | GOOGL v4 | 下一份报告最低标准 |
|------|---------|---------|-----------------|
| 总字符 | ~148,000 | ~307,000 | ≥行业系数×85K |
| 标注密度 | 47/万 | — | ≥40/万 |
| 硬数据% | 62.4% | — | ≥55% |
| Mermaid图 | 7 | 8 | **≥10** |
| Mermaid类型 | 3种 | 6种 | **≥4种** |
| Kill Switch | 15 | — | ≥15 |
| 可验证预测 | 20 | — | ≥20 |
| Bear Case | 8 | — | ≥8 |
| Agent数 | 19+7 | — | — |

#### 执行规则

1. **Phase 5 完成前必须运行回归对比** — 使用 `phase-gate-validator` skill 的回归模式
2. **退步项必须书面说明** — "刻意精简"(接受) vs "遗漏"(不接受，必须修正)
3. **退步≥3项 = 报告不合格** — 必须修正后才能标记完成
4. **基准线每次更新** — 新报告发布后，更新本节基准线数据

---

### 输出前检查

- [ ] Mermaid必选图全部包含(≥10张 Tier 3 / ≥5张 Tier 2)
- [ ] Mermaid类型 ≥ 4种
- [ ] 每张图后有解读段落
- [ ] Mermaid代码块完整(有开始和结束标记)
- [ ] 表格格式正确对齐
- [ ] 无乱码或未完成的代码片段
- [ ] 章节层级清晰(H2/H3/H4)
- [ ] 回归检查通过(退步项<3且已说明)
