# 复利学习飞轮 v1.0

> 每次研究让下一次更好。不是线性积累，是指数提升。

---

## 1. 架构总览

### 三层架构

```
┌─────────────────────────────────────────────────┐
│  L1 主控层 (Main)                                │
│  框架管理 · 质量标准 · 知识银行 · 跨行业学习      │
│  docs/ · tests/ · CLAUDE.md · 实证数据库          │
└────────┬──────────┬──────────┬──────────┬────────┘
         │          │          │          │
    ┌────▼───┐ ┌────▼───┐ ┌───▼────┐ ┌───▼────┐
    │L2 金融 │ │L2 消费 │ │L2 半导 │ │L2 科技 │ ...
    │行业专规│ │行业专规│ │行业专规│ │行业专规│
    │报告执行│ │报告执行│ │报告执行│ │报告执行│
    └────┬───┘ └────┬───┘ └───┬────┘ └───┬────┘
         │          │         │          │
    ┌────▼───┐ ┌────▼───┐ ┌───▼────┐ ┌───▼────┐
    │L3 Agent│ │L3 Agent│ │L3 Agent│ │L3 Agent│
    │3-5/批次│ │3-5/批次│ │3-5/批次│ │3-5/批次│
    │Phase执行│ │Phase执行│ │Phase执行│ │Phase执行│
    └────────┘ └────────┘ └────────┘ └────────┘
```

### 当前信息流（单向，有缺陷）

```
Main ──push──> Worktree ──dispatch──> Agents ──write──> Reports ──[死路]
```

### 目标信息流（飞轮，复利）

```
Main ──push──> Worktree ──dispatch──> Agents ──write──> Reports
  ▲                                                        │
  │                                                        ▼
  │                                                  反思 (Post-Mortem)
  │                                                        │
  │                                                        ▼
  └────codify────  提炼通用教训  ◄────extract────  结构化Lessons
                        │
                        ▼
                  git merge → 所有Worktree
                        │
                        ▼
                  下一次研究更好 → 更好的Reports → 更好的反思 → ...
```

---

## 2. 飞轮的四个齿轮

### 齿轮1: 执行 (Execute)

在Worktree内按Phase 0-5执行Tier 3研究。这是产出。

**当前状态**: 稳定。7个项目验证了Phase结构。

### 齿轮2: 反思 (Reflect)

Complete报告质量门控通过后，**必须**执行结构化反思。

**当前状态**: 缺失。只有危机时才反思（META质量回退催生v24.0）。

### 齿轮3: 提炼 (Extract)

从反思中提取可泛化的教训，写入知识银行。

**当前状态**: 零散。教训散落在MEMORY.md和各种commit message中。

### 齿轮4: 传播 (Propagate)

通过git merge main将提炼的教训传播到所有Worktree。

**当前状态**: v25.0刚建立。之前各worktree v19-v24碎片化。

---

## 3. 实证数据库 — 13个项目的真实数据

> 最后更新: 2026-02-11 (第二次正式反思 — 新增TSM/TSLA/GOOGL v3.0)

### Complete报告质量矩阵 (8份通过CG门控)

| 项目 | 行业 | 版本 | 总字符 | 标注 | 硬数据% | 密度/万 | Mermaid | CI | CG | KS/VP/CQ |
|------|------|:----:|:------:|:----:|:------:|:------:|:------:|:--:|:--:|:--------:|
| **TSLA** | 生态科技 | v26+OVM | **534K** | 1,650 | 36.0% | 30.0 | **89** | — | 13/13 | 19/23/7 |
| **GOOGL v3** | 生态科技 | v26+OVM | **528K** | 1,761 | 54.0% | 33.3 | 84 | — | 13/13 | 19/23/7 |
| PLTR | 生态科技 | v26 | 457K | 1,356 | 50.3% | 29.6 | 74 | 25 | 11/11 | 19/22/7 |
| **TSM** | 半导体 | v26+OVM | **451K** | 1,584 | 55.0% | **36.0** | 83 | 4 | **13/13** | 19/23/8 |
| META | 科技 | v24 | 317K | 550+ | — | — | — | — | 11/11 | 16/22/— |
| GOOGL v2 | 科技 | v22 | 311K | 1,074 | 50.0% | 34.5 | 8 | 0 | 11/11 | 14/17/6 |
| SOFI | 金融 | v26 | 295K | 975 | 54.1% | 33.1 | 31 | 30 | 11/11 | 23/22/14 |
| COST | 消费 | v26 | 282K | 953 | 42.0% | 33.9 | 64 | 19 | 11/11 | 20/25/9 |
| MU | 半导体 | v26 | 179K | 590 | 47.6% | 33.1 | 30 | 13 | 10/11 | 18/22/8 |

**趋势**: 平均字符从305K→385K(+26%), Mermaid从8→83均值(v26效应), 密度稳定~33/万

### Agent架构实证对比 (研究过程)

| 项目 | 行业 | 总Agents | 关键Phase配置 | 总产出 | vs目标 | 质量 |
|------|------|:-------:|-------------|:------:|:-----:|------|
| **TSLA v2** | 生态科技 | ~25+ | P1-5增量+OVM, P3:5A | 534K | ~215% | 1650标注, 89 Mermaid, OVM全量 |
| **GOOGL v3** | 生态科技 | ~25+ | v26+OVM全量重做 | 528K | ~212% | 1761标注, 84 Mermaid, 13/13 CG |
| PLTR | 生态科技 | ~25+ | P0.5:5规划, P1-4均4-5 | 457K | ~200% | 1356标注, 74 Mermaid, 全CG通过 |
| **TSM v2** | 半导体 | ~29 | P0:8, P2:5, P3:5, P5:3 | 451K | **181%** | 1584标注, 83 Mermaid, **13/13 CG** |
| META | 科技 | ~25 | P1:3, P2:4, P3:5, P4:4, P5:3 | 317K | 187% | 550+标注, 16KS, 22VP |
| GOOGL v2 | 科技 | ~20 | 类似META | 311K | ~165% | SOTP-DCF偏差2.5% |
| SOFI | 金融 | ~19 | P2:5, P3:5, P4:3, P5:3 | 295K | 175% | 975标注, 54%硬数据, 全CG通过 |
| COST | 消费 | ~27 | P0:7微型, P1-4分散 | 282K | ~180% | 953标注, 64 Mermaid, 全CG通过 |
| PG | 消费 | ~19 | P4: 4大型(M/N/O/P) | 205K | 216% | 731标注, 57%硬数据 |
| MU | 半导体 | ~15 | v26全流程首尝试 | 179K | ~120% | 590标注, CG1未通过(179K<249K) |
| TSM v1 | 半导体 | ~8+线性 | P0:8专精 | 100K | ~130% | v20标准(已被v2替代) |

### 关键发现 (更新版 — 13项目实证)

**发现1: 最佳Agent团队规模 = 4-5/Phase** (强化)
- 5个Agent的Phase产出超目标50-80% (SOFI P2:180%, META P2:148%, TSM P2:~300%)
- 3个Agent的Phase产出刚好达标或超出 (TSM P5:205%, META P5:106%, SOFI P4:101%)
- 8个微型Agent有重叠风险 (TSM P0的8Agent vs PLTR P0.5的5Agent)
- **新铁律**: P5 = 3Agent (META/SOFI/TSM三项目一致验证)

**发现2: 最佳单Agent产出 = 10-20K字符** (上调)
- TSM P5均值: ~23K ← 新高（3 Agent高产）
- SOFI P2均值: 12.4K ← 经典最佳
- META P3均值: 13.4K ← 经典最佳
- COST微型Agent: 5.5K ← 太碎片化
- **新发现**: P5 Agent产出可达20K+, 因为决策输出模块数据密度高

**发现3: 标注密度天花板~33/万** (验证不变)
- 8个Complete报告密度: 29.6-36.0/万，均值**32.7** (前5均值33.3)
- TSM 36.0/万是新高点(半导体数据密度天然高)
- TSLA 30.0/万偏低(叙事性内容占比大)
- 地板25/万建议不变

**发现4: Mermaid可视化v26稳定在70-90区间** (稳定)
- v22(GOOGL): 8张 → v26均值: **82.5张** (PLTR 74/TSM 83/GOOGL v3 84/TSLA 89)
- v26+OVM报告天然多图(OVM组件需可视化)
- **Mermaid地板建议**: 从8→24(历史最低的~30%)

**发现5: Bear Case占比改善但仍不足** (跟踪)
- TSM P4: 74.3K/451K = **16.5%** (前5个报告10-13.4%)
- 改善原因: TSM P4有4个Agent(含2个纯看空)
- 仍低于18%目标 → 需要P4增加第二轮看空或增大产出目标
- **建议**: Phase 4 bear case占比下限18%, 目标20%+

**发现6: OVM是500K+报告的关键驱动** (新发现)
- 有OVM的报告: TSLA 534K, GOOGL v3 528K, TSM 451K → 均值504K
- 无OVM的报告: PLTR 457K, COST 282K, SOFI 295K → 均值345K
- OVM增加~30-50K直接内容 + 倒逼核心估值更严谨
- **建议**: P/E>30x或有pre-revenue业务线的公司默认启用OVM

**发现7: 每个项目贡献一个框架创新** (更新至13项目)

| 项目 | 贡献 | 框架版本 | 传播 |
|------|------|---------|:----:|
| TSM v1 | 预测市场PPDA/PMSI | v10.0 | ✅ |
| COST v1 | 微型Agent模式+MTC协议 | v19-v21 | ⚠️ |
| GOOGL v2 | 反幻觉协议+DM锚点+CG基准 | v22.0 | ✅ |
| PG | Phase 4看空强化(独立Agent) | v22.0 | ✅ |
| META | 铁律F质量不回退+CG门控11项 | v24.0 | ✅ |
| SOFI v1 | Checkpoint协议+Agent返回压缩 | v25.0 | ✅ |
| PLTR | Phase 0.5 CQ提取+温度计策略 | v26.0 | ✅ |
| MU | RDI v2.0验收标准 | v26.0 | ✅ |
| COST v2 | CI注册表+框架注册表+F×D矩阵 | v26.0 | 🔄 |
| SOFI v3 | CI注册表跨行业验证 | v26.0 | 🔄 |
| **TSM v2** | **六方法SOTP收敛 + CQ置信度路径** | v26.0+OVM | ✅ 本次编码 |
| **TSLA v2** | **OVM-7 PMX飞轮 + Core/Options分解** | v26.0+OVM | ✅ 已传播 |
| **GOOGL v3** | **OVM TAM Ceiling + 跨方法交叉验证** | v26.0+OVM | ✅ 已传播 |

**这就是复利**: 13个项目 → 13个框架创新。v26.0+OVM是v10-v26累积的结晶。飞轮从被动→主动→加速。

---

## 4. 结构化反思协议 (Post-Mortem)

### 触发时机
- Complete报告通过CG门控后，**同一会话内**执行
- 如果context不足，作为下一会话的**第一个任务**

### 反思模板

在 `reports/{TICKER}/data/` 中写入 `reflection.md`:

```markdown
# {TICKER} 研究反思 — {日期}

## 1. 数字摘要
- 总字符: {X}K (目标{Y}K的{Z}%)
- 总Agents: {N}个, 分{M}批
- 最佳Phase: {Phase X} — 因为{原因}
- 最差Phase: {Phase Y} — 因为{原因}
- 框架版本: v{A.B}

## 2. 什么工作得好？(保持)
- {具体做法} → {量化效果}

## 3. 什么工作得不好？(改进)
- {具体问题} → {根因} → {建议改进}

## 4. 发现了什么新模式？(提炼)
- {模式描述} → {适用范围} → {建议编码到哪个docs/文件}

## 5. Agent架构评估
| Phase | Agent数 | 产出/Agent | 评价 | 下次建议 |
|-------|---------|-----------|------|---------|

## 6. 对其他行业的启示
- {insight} → 适用于{行业/worktree}

## 7. 框架改进提案 (如有)
- 提案: {描述}
- 影响文件: {docs/xxx.md}
- 优先级: {高/中/低}
```

### 反思后动作

1. `reflection.md` 提交到当前worktree
2. 如果有框架改进提案 → 切换到main → 更新对应docs/ → commit
3. 运行 `bash tests/framework_health_check.sh` 确认传播准备
4. `git merge main` 到所有活跃worktree
5. 更新本文件的"实证数据库"章节

---

## 5. 主控-蜂群关系设计

### 主控(Main)的职责 — 不是指挥官，是知识银行

| 职责 | 具体内容 | 不做的事 |
|------|---------|---------|
| 知识保管 | 维护docs/中的所有框架文档 | 不直接执行研究 |
| 质量标准 | 定义CG门控标准、Fast Gate | 不在运行中干预Agent |
| 跨行业学习 | 汇总各worktree的reflection | 不强制统一Agent架构 |
| 工具维护 | tests/脚本、.claude/skills/ | 不规定Agent数量 |
| 健康监控 | framework_health_check.sh | 不自动修复(提醒人) |

### 蜂群(Worktree)的自主权

| 自主权 | 说明 |
|--------|------|
| Agent数量 | 根据模块复杂度自行决定(参考指导原则) |
| Agent命名 | 自由(Greek字母/功能名/编号) |
| 执行节奏 | 3+2还是4+1由context状态决定 |
| 行业专规 | thin-shell CLAUDE.md中的行业部分自行维护 |
| 本地优化 | 可在worktree内实验新做法 |

### 蜂群向主控的反馈义务

| 义务 | 时机 | 格式 |
|------|------|------|
| reflection.md | Complete报告通过后 | 上述模板 |
| 框架改进提案 | 发现可泛化的新做法时 | reflection.md第7节 |
| 实证数据 | 每Phase完成 | STATUS.md自动记录 |
| 失败报告 | Agent失败/质量不达标时 | agent_logs/ |

---

## 6. Worktree内部架构 — Agent团队设计原则

### 从实证数据提炼的5条原则 (已编码到 `docs/parallel_execution.md` v6.0)

1. **模块驱动Agent数量**: 按模块数和复杂度，不是固定数字
2. **按类型设产出目标**: 数据密集12-20K / 分析判断10-15K / 输出型5-8K
3. **Context感知动态调整**: 前期4-5 Agent / 后期2-3 Agent
4. **看空Agent必须独立**: 不读前序看多结论
5. **Checkpoint必写**: 每批次完成后

### Agent团队设计参考表 (基于13个项目实证)

| Phase | 推荐Agent数 | 推荐产出/Agent | 实证依据 |
|:---:|:---:|:---:|---------|
| 0 | **5** 专精 | 数据文件 | SOFI/META/PLTR (TSM 8个过多, 有重叠) |
| 0.5 | 3-5 规划 | 10-20K | META α1-α5 |
| 1 | 3-4 | 10-15K | META δ1-3, PLTR α-δ, TSM 4A |
| 2 | **5** | 15-30K | SOFI 5A(180%), TSM 5A(**148K**最高) |
| 3+3.5 | 4-5 | 12-17K | META ζ1-5, PLTR 5A, TSM 5A(82K) |
| 4 | 4 (≥2纯看空) | 12-22K | PG M/N/O/P, TSM 4A(74K), 需↑看空比例 |
| 5 | **3 (铁律)** | **15-23K** | META/SOFI/TSM三项目一致验证 |

### Agent间协作模式

```
模式A: 独立并行 (默认)
Agent_1 ──→ staging_1.md
Agent_2 ──→ staging_2.md    共享: shared_context.md (只读)
Agent_3 ──→ staging_3.md
主线程 ◄── 汇总合并

模式B: 接力式 (罕见，仅Phase 0数据链)
Agent_1 ──→ raw_data ──→ Agent_2 ──→ structured_data ──→ Agent_3

模式C: 对抗式 (Phase 4专用)
Agent_看多 ──→ 看多论证
Agent_看空 ──→ 独立看空 (不读看多)    ← 铁律: 信息隔离
主线程 ◄── 综合裁决
```

---

## 7. 飞轮运行协议 — 定期触发

### 触发条件

| 触发 | 动作 |
|------|------|
| Complete报告通过CG | 执行反思 → 写reflection.md → 提取教训 |
| 累计完成3个新项目 | 更新本文件的实证数据库 + 重新审视原则 |
| 框架版本跳号(vN→vN+1) | 检查所有worktree同步状态 |
| 会话启动(铁律D步骤3) | 运行健康检查 |
| 用户明确要求 | 全面反思 + 架构审视 |

### 飞轮执行检查清单

```
□ 读取最近3个项目的reflection.md
□ 对比实证数据库的趋势(是否在改善)
□ 识别跨项目的重复问题
□ 提出≤3个改进提案
□ 更新本文件
□ 如有框架修改 → commit main → merge到活跃worktree
□ 运行 bash tests/framework_health_check.sh 确认健康
```

### 复利量化指标

跟踪以下指标的项目间趋势：

| 指标 | 方向 | 说明 |
|------|------|------|
| 标注密度(/万字符) | ↑ | v21: 15目标 → v25实际: 30-48 |
| 硬数据占比 | ↑ | v21: 40%目标 → v25实际: 57-75% |
| 产出/Agent(K字符) | 稳定 | 10-15K是甜点区 |
| 产出vs目标(%) | 稳定偏↓ | 155%均值说明目标可上调 |
| Agent失败率 | ↓ | <1%，已接近零 |
| Context耗尽次数/项目 | ↓ | v25前约3-5次 → v25目标≤2次 |
| 框架更新间隔(项目数) | 从1→3+ | 目标: 不再每个项目都改框架 |

---

## 8. 跨Worktree知识传递路径

### 已验证的跨行业适用模式

| 模式 | 来源项目 | 已扩展到 | 效果 |
|------|---------|---------|------|
| DM锚点系统 | GOOGL | SOFI, META, PLTR | 消除跨Phase数据不一致 |
| Checkpoint.yaml | SOFI | META, PLTR | 1句话恢复 vs 500字prompt |
| CG门控11项 | META | 所有(v24.0) | 防质量回退 |
| Agent返回压缩 | v23.0设计 | PLTR首用 | 94%context节省 |
| 看空Agent隔离 | PG Phase 4 | 所有(v22.0) | 更强的对抗审查 |

### 已传播的新模式 (第二次反思新增)

| 模式 | 来源 | 已扩展到 | 效果 |
|------|------|---------|------|
| 六方法SOTP收敛 | TSM v2 | 可用于所有 | 比单一估值更诚实, 中位/加权偏差<2% |
| CQ置信度路径P1→P5 | TSM v2 | 可用于所有 | P4后CQ下调=对抗成功的验证信号 |
| OVM-7 PMX飞轮 | TSLA v2 | GOOGL v3已用 | 解决生态系统公司估值脱节 |
| OVM TAM Ceiling | GOOGL v3 | TSM已验证 | "即使全部成功也<市价"杀手级信号 |

### 潜在但未传播的模式

| 模式 | 来源 | 为何未传播 | 适用行业 | 状态 |
|------|------|-----------|---------|:----:|
| CI注册表(非共识洞察) | SOFI v3/COST v2 | 首次反思编码 | **所有** | 🔄 编码中 |
| 框架注册表 | COST v2 | 首次反思编码 | **所有** | 🔄 编码中 |
| MTC协议(微型Agent) | COST v1 | 未反思提炼 | 数据密集型Phase 0 | ⚠️ |
| PPDA背离分析 | TSM v1 | 仅在半导体 | 所有有预测市场数据的 | ⚠️ |
| 信用风暴矩阵 | SOFI | 仅在金融 | 有信贷敞口的 | ⚠️ |
| **Worktree脚本同步** | TSM v2(痛点) | 待解决 | **所有worktree** | ⚠️ 待编码 |

**飞轮进展**: 4个新模式已通过第二次反思确认传播。3个待下次反思处理。1个基础设施问题(worktree脚本同步)需技术解决。

---

## 9. 下一次迭代目标

### 已回答的问题 (2026-02-11第二次反思)
1. ✅ Phase 0.5的5-agent规划模式效果: PLTR验证有效(457K)
2. ✅ v26.0 checkpoint: 多会话连续性显著改善
3. ✅ OVM对报告规模的影响: 有OVM报告均值504K vs 无OVM 345K (+46%)
4. ✅ P5=3Agent: META/SOFI/TSM三项目验证, 可编码为铁律
5. ✅ 六方法SOTP收敛: TSM验证中位/加权偏差<2%, 最强估值框架
6. ✅ CQ下调=P4成功: TSM 6/8 CQ下调3-12pp, 健康模式确认

### 下一轮反思重点 (3个Complete后触发)
1. CI注册表编码后, 新报告的D5得分是否系统性提升？
2. Bear case占比在P4强化后是否达到18%目标？
3. 六方法收敛在消费/金融行业的适用性？(半导体/科技已验证)
4. Worktree脚本同步机制实施后, debug成本是否下降？
5. VP命名统一后, CG5/CG6首次通过率是否达100%？

### 框架稳定性目标
- v26.0+OVM已支撑8个Complete报告(4行业), 框架高度稳定
- 本次改进为v26.2(小版本): 六方法收敛编码 + P5=3A铁律 + CQ下调验证
- 下一次大版本升级: 仅当反思发现系统性问题时
- **飞轮状态**: 从被动(v1, 危机驱动) → 主动(v2, 反思驱动) → **加速(v3, 13项目复利)**

---

*本文件本身也是飞轮的一部分 — 每次反思后更新。*
*最后更新: 2026-02-11 — 第二次正式反思，13项目实证(+TSM/TSLA/GOOGL v3.0)*
