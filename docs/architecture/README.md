# 投资大师 Agent 架构文档

> 基于Clawdbot设计洞见构建的投资分析Agent架构

---

## 文档索引

| 文档 | 版本 | 说明 |
|------|------|------|
| [agent_design_principles_v1.md](./agent_design_principles_v1.md) | v1.0 | 7大设计原则，架构总览 |
| [analysis_loop_v1.md](./analysis_loop_v1.md) | v1.0 | 6阶段分析循环设计 |
| [analysis_hooks_v1.md](./analysis_hooks_v1.md) | v1.0 | Hook扩展点设计 |
| [context_management_v1.md](./context_management_v1.md) | v1.0 | Context管理三层策略 |

---

## 核心洞见

本架构基于Clawdbot Gateway设计理念，提炼出7个核心洞见：

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        7大设计洞见                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  1. 单点协调者模式    Master Framework是唯一入口和协调者                    │
│                                                                             │
│  2. 文件即状态        报告MD、历史JSONL、框架YAML，无需数据库               │
│                                                                             │
│  3. Context管理       三层策略：Pruning → Compaction → Memory Flush         │
│                                                                             │
│  4. 分析Loop设计      需求→上下文→推理→数据→报告→归档                       │
│                                                                             │
│  5. Session隔离       不同分析类型使用不同session策略                        │
│                                                                             │
│  6. Hook扩展点        生命周期钩子支持灵活扩展                               │
│                                                                             │
│  7. Skill模块化       投资方法论YAML化、可迭代升级                           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 架构总览

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      投资大师 Agent 架构                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│                    ┌─────────────────────────┐                              │
│                    │   Master Framework      │                              │
│                    │     (单点协调者)         │                              │
│                    └───────────┬─────────────┘                              │
│                                │                                            │
│              ┌─────────────────┼─────────────────┐                          │
│              │                 │                 │                          │
│              ▼                 ▼                 ▼                          │
│        ┌──────────┐     ┌──────────┐     ┌──────────┐                      │
│        │  Skills  │     │   APIs   │     │ Memory   │                      │
│        │ (模块库) │     │ (数据源) │     │ (知识库) │                      │
│        └──────────┘     └──────────┘     └──────────┘                      │
│                                                                             │
│        ┌────────────────────────────────────────────┐                      │
│        │              Analysis Loop                 │                      │
│        │  Intake → Context → Infer → Tool → Reply → Persist               │
│        └────────────────────────────────────────────┘                      │
│                                                                             │
│        ┌────────────────────────────────────────────┐                      │
│        │                 Hooks                      │                      │
│        │  start → phase → data → quality → end     │                      │
│        └────────────────────────────────────────────┘                      │
│                                                                             │
│        ┌────────────────────────────────────────────┐                      │
│        │            File-based State               │                      │
│        │  reports/*.md | history/*.jsonl | *.yaml  │                      │
│        └────────────────────────────────────────────┘                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 文档关系

```
agent_design_principles_v1.md   ← 总纲，7大洞见
         │
         ├── analysis_loop_v1.md        ← 详解洞见4：分析Loop
         │
         ├── analysis_hooks_v1.md       ← 详解洞见6：Hook扩展
         │
         └── context_management_v1.md   ← 详解洞见3：Context管理
```

---

## 快速参考

### 分析Loop 6阶段
1. **Intake** - 解析请求、验证参数、路由session
2. **Context** - 加载框架、历史、skill，检查预算
3. **Inference** - 规划分析路径、识别数据需求
4. **Tool** - 调用API、搜索、验证数据
5. **Reply** - 生成报告、质量门控、双版本输出
6. **Persist** - 保存报告、更新历史、提取lessons

### Hook类型
- **生命周期**: analysis:start/end, phase:complete
- **数据**: api_call, validation, cache
- **质量**: score_below, data_issue, retry
- **知识**: lesson_added, prediction_created

### Context优先级
1. 当前分析关键数据 (必须)
2. 公司历史摘要 (优先)
3. 方法论框架 (按需)
4. 行业背景 (可选)
5. 历史详情 (工具获取)

---

## 版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| v1.0 | 2026-01-30 | 初始版本，基于Clawdbot设计洞见 |

---

*学习来源：Clawdbot Gateway架构设计*
