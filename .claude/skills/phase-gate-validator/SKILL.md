---
name: phase-gate-validator
description: Phase质量门控自动验证。检查标注密度、硬数据占比、字符数、CQ覆盖率、Kill Switch数量等。替代手动逐项核对QG-01~QG-12。适用于每个Phase完成时。
---

# Phase 质量门控验证技能 v1.0

> 来源: COST v21 QG-01~QG-12 手动核对经验 + research_fast.sh 自动化
> 解决: 人工检查遗漏项 + 标准不统一 + 检查耗时

## 触发条件

- 每个 Phase 完成时（必须触发）
- Phase 内单个 Agent 完成时（建议触发，快速模式）

## 两种模式

| 模式 | 检查范围 | 耗时 | 触发时机 |
|------|---------|------|---------|
| **快速模式** | 单Agent产出 — 字符/标注/硬数据 | <1分钟 | Agent完成后 |
| **完整模式** | 整个Phase — 全部门控项 | 3-5分钟 | Phase完成后 |

## 快速模式 (Agent级)

对单个Agent产出文件检查：

```markdown
## Agent {ID} 快速检查
- 文件: {文件名}
- 字符数: {N} (目标: {下限}-{上限}) → ✅/❌
- 标注数: {N} (密度: {N}/万字符, 目标: ≥15) → ✅/❌
- 硬数据占比: {N}% (目标: ≥40%) → ✅/❌
- CQ关联: {列出关联的CQ} → ✅/❌
- 数据锚点引用: {N}个 → ✅/❌
- 自检声明: 有/无 → ✅/❌
```

**不通过处理**: 通知主线程，标记问题项，Agent修正后重新检查。

## 完整模式 (Phase级)

### 通用门控项 (所有Phase适用)

| # | 门控项 | 检查方法 | 通过标准 |
|---|--------|---------|---------|
| G-01 | 总字符数 | `wc -m` | ≥Phase目标字符 |
| G-02 | 标注密度 | 计数 `[硬数据:]` `[合理推断:]` `[主观判断:]` | ≥15个/万字符 |
| G-03 | 硬数据占比 | 硬数据标注数 / 总标注数 | ≥40% |
| G-04 | 数据锚点引用 | 搜索 `DA-` 引用 | 每Agent ≥3个 |
| G-05 | 无源数字 | 搜索未标注的关键数字 | 0个无源数字 |
| G-06 | CQ覆盖 | 检查本Phase应覆盖的CQ | 100%覆盖 |
| G-07 | 表格数量 | 计数markdown表格 | ≥Phase目标 |

### Phase专用门控项

#### Phase 0+0.5
| # | 门控项 | 通过标准 |
|---|--------|---------|
| QG-P0-01 | 数据文件数 | ≥8个(理想14个) |
| QG-P0-02 | XV交叉验证完成 | CONFLICT全部解决 |
| QG-P0-03 | Core Questions提取 | 5-8个CQ + 注意力分排序 |
| QG-P0-04 | 执行计划生成 | Phase 1-5 Agent设计完成 |

#### Phase 1: 定位与生态
| # | 门控项 | 通过标准 |
|---|--------|---------|
| QG-01 | 公司画像完整 | 业务模型+管理层+历史≥3,000字 |
| QG-02 | 产业链映射 | ≥10个关键节点 |
| QG-03 | 预测市场数据 | ≥8个相关事件 |

#### Phase 2: 财务与估值
| # | 门控项 | 通过标准 |
|---|--------|---------|
| QG-04 | 周期定位 | ≥4个支撑信号 |
| QG-05 | SOTP覆盖率 | 覆盖≥90%营收的分部 |
| QG-06 | 估值交叉验证 | SOTP vs DCF偏离<20% |

#### Phase 3: 战略深度
| # | 门控项 | 通过标准 |
|---|--------|---------|
| QG-07 | 护城河量化 | 每种护城河有数据支撑 |
| QG-08 | 五引擎 | 每引擎≥1,500字 |
| QG-09 | 竞争分析 | PPDA≥3个背离(消费品) / 竞对≥3个(其他) |
| QG-09.5 | AI冲击矩阵 | 覆盖≥90%营收分部 |

#### Phase 4: 对抗审查
| # | 门控项 | 通过标准 |
|---|--------|---------|
| QG-10 | 偏差检查 | 四项偏差全部完成+量化修正 |
| QG-11 | 事实核查+反证 | ≥10点核查 + ≥3条反证 |
| QG-11.5 | 看空占比 | 看空内容≥总篇幅30% |

#### Phase 5: 决策输出
| # | 门控项 | 通过标准 |
|---|--------|---------|
| QG-12 | Kill Switch | ≥15条(含≥2个AI相关) |
| QG-12.5 | 可验证预测 | ≥20个+时间锚定 |
| QG-13 | 投资日历 | 90天行动清单完整 |

## 输出格式

```markdown
# Phase {N} 质量门控报告

## 总览
- Phase: {名称}
- Agent数: {N}
- 总字符: {N} / 目标{N} → {达成率}%
- 通过/总计: {通过数}/{总门控数}
- **结论: ✅ 通过 / ❌ 不通过**

## 通用门控
| 门控项 | 实际值 | 目标 | 结果 |
|--------|--------|------|:----:|
| 标注密度 | 47/万 | ≥15/万 | ✅ |
| 硬数据占比 | 62% | ≥40% | ✅ |
| ... | ... | ... | ... |

## Phase专用门控
| 门控项 | 实际值 | 目标 | 结果 |
|--------|--------|------|:----:|
| QG-XX | ... | ... | ✅/❌ |

## 各Agent质量
| Agent | 字符 | 标注(密度) | 硬数据% | 锚点 | 通过 |
|-------|------|-----------|---------|------|:----:|
| P{N}-A | ... | ... | ... | ... | ✅ |

## 不通过项修正建议
{仅当有不通过项时输出}
```

## COST v21 实战参考

| Phase | 门控总数 | 通过数 | 首次通过率 |
|-------|---------|--------|-----------|
| 0+0.5 | 4 | 4 | 100% |
| 1 | 3+7通用 | 10 | 100% |
| 2 | 3+7通用 | 10 | 100% |
| 3+3.5 | 4+7通用 | 11 | 100% |
| 4 | 3+7通用 | 10 | 100% |
| 5 | 3+7通用 | 10 | 100% |
