# /migrate-framework - 框架迁移技能

## 触发命令
`/migrate-framework [源worktree] [目标worktree]`
`/migrate-framework [框架名称]`

## 功能描述
安全地在worktree之间迁移框架、配置或分析能力，包括：
- 自动识别迁移范围
- 创建迁移文档
- 版本冲突检测
- 增量同步支持

## 执行流程

### Step 1: 迁移范围确认
```yaml
自动检测:
  1. 源worktree位置和内容
  2. 目标worktree当前状态
  3. 待迁移文件列表
  4. 潜在冲突预警

输出格式:
  📦 框架迁移计划

  📂 源位置：[源worktree路径]
  📂 目标位置：[目标worktree路径]

  📋 待迁移内容：
  - frameworks/v10.0-prediction-market/ (13个文件, 45KB)
  - skills/v10.0-engines/ (5个文件, 113KB)
  - configs/*.yaml (3个文件, 8KB)

  ⚠️ 冲突检测：
  - CLAUDE.md: 目标版本v19.12 vs 源版本v10.0
    建议: 合并而非覆盖

  ❓ 确认执行迁移？
```

### Step 2: 创建迁移文档
```yaml
文件: MIGRATION.md (目标worktree根目录)

内容:
  # 框架迁移记录

  **迁移时间**: [时间戳]
  **迁移方向**: [源] → [目标]
  **执行者**: Claude Code

  ## 迁移内容清单
  | 文件路径 | 状态 | 备注 |
  |---------|------|------|
  | frameworks/... | ✅ 完成 | - |
  | skills/... | ✅ 完成 | - |

  ## 版本变更
  - 源版本: v10.0
  - 目标版本: v10.0 (新增)

  ## 验证状态
  - [ ] 文件完整性检查
  - [ ] 配置语法验证
  - [ ] 功能测试
```

### Step 3: 执行迁移
```yaml
迁移策略:
  新文件: 直接复制
  已存在文件:
    - 相同: 跳过
    - 不同: 询问处理方式
      1️⃣ 覆盖目标
      2️⃣ 保留目标
      3️⃣ 合并内容
      4️⃣ 逐个确认

保护机制:
  - 迁移前自动备份目标文件
  - 备份位置: .migration_backup/[时间戳]/
  - 支持一键回滚
```

### Step 4: 验证与报告
```yaml
验证步骤:
  1. 文件完整性: 检查所有文件已正确复制
  2. 语法检查: YAML/MD文件格式验证
  3. 交叉引用: 检查文件间引用是否有效
  4. 配置一致性: 验证配置参数兼容

完成报告:
  ✅ 迁移完成！

  📊 迁移统计：
  - 文件数量: 21个
  - 总大小: 166KB
  - 新增: 18个
  - 更新: 3个
  - 跳过: 0个

  📝 迁移文档: MIGRATION.md
  🔙 回滚命令: /migrate-rollback [时间戳]
```

## 常用迁移场景

### 场景1: v10.0框架迁移到新行业
```
/migrate-framework 半导体 消费品
```
自动识别v10.0框架核心文件，适配消费品行业配置

### 场景2: 主分支升级同步
```
/migrate-framework main 半导体
```
将主分支的通用升级同步到专业worktree

### 场景3: 特定框架迁移
```
/migrate-framework prediction-market
```
只迁移预测市场相关框架文件

## 安全保护

```yaml
禁止操作:
  ❌ 覆盖未备份的文件
  ❌ 迁移到错误的worktree
  ❌ 破坏专业化配置
  ❌ 跳过冲突确认

强制确认:
  - 每次迁移前显示完整计划
  - 每个冲突文件单独确认
  - 迁移完成后验证报告
```

## 版本
v1.0 - 2026-02-06
