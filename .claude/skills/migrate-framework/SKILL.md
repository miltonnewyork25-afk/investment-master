# /migrate-framework - 框架迁移技能

## 触发命令
`/migrate-framework [源worktree] [目标worktree]`
`/migrate-framework [框架名称]`

## 功能描述
安全地在worktree之间迁移框架、配置或分析能力，包括：
- 自动识别迁移范围
- 创建MIGRATION.md迁移文档
- 版本冲突检测
- 增量同步支持

## 执行流程

### Step 1: 迁移范围确认
```yaml
自动检测:
  1. 源worktree位置和内容
  2. 目标worktree当前状态
  3. 待迁移文件列表
  4. 潜在冲突预警

输出格式:
  📦 框架迁移计划

  📂 源位置：[源worktree路径]
  📂 目标位置：[目标worktree路径]

  📋 待迁移内容：
  - frameworks/v10.0-prediction-market/ (文件数, 大小)
  - skills/ (文件数, 大小)
  - configs/*.yaml (文件数, 大小)

  ⚠️ 冲突检测：
  - [文件]: 目标版本[X] vs 源版本[Y]
    建议: 合并而非覆盖

  ❓ 确认执行迁移？
```

### Step 2: 创建迁移文档
```yaml
文件: MIGRATION.md (目标worktree根目录)

内容:
  # 框架迁移记录

  **迁移时间**: [时间戳]
  **迁移方向**: [源] → [目标]
  **执行者**: Claude Code

  ## 迁移内容清单
  | 文件路径 | 状态 | 备注 |
  |---------|------|------|
  | frameworks/... | ✅ 完成 | - |
  | skills/... | ✅ 完成 | - |

  ## 版本变更
  - 源版本: [版本]
  - 目标版本: [版本]

  ## 验证状态
  - [ ] 文件完整性检查
  - [ ] 配置语法验证
  - [ ] 功能测试
```

### Step 3: 执行迁移
```yaml
迁移策略:
  新文件: 直接复制
  已存在文件:
    - 相同: 跳过
    - 不同: 询问处理方式
      1️⃣ 覆盖目标
      2️⃣ 保留目标
      3️⃣ 合并内容
      4️⃣ 逐个确认

保护机制:
  - 迁移前自动备份目标文件
  - 备份位置: .migration_backup/[时间戳]/
  - 支持一键回滚
```

### Step 4: 验证与报告
```yaml
验证步骤:
  1. 文件完整性: 检查所有文件已正确复制
  2. 语法检查: YAML/MD文件格式验证
  3. 交叉引用: 检查文件间引用是否有效
  4. 配置一致性: 验证配置参数兼容

完成报告:
  ✅ 迁移完成！

  📊 迁移统计：
  - 文件数量: [N]个
  - 总大小: [X]KB
  - 新增: [N]个
  - 更新: [N]个
  - 跳过: [N]个

  📝 迁移文档: MIGRATION.md
  🔙 回滚命令: /migrate-rollback [时间戳]
```

## 半导体常用迁移场景

### 场景1: 主分支升级同步到半导体
```
/migrate-framework main 半导体
```
将主分支的通用升级（PPDA/PMSI算法改进等）同步到半导体worktree

### 场景2: 半导体创新同步到主分支
```
/migrate-framework 半导体 main
```
将半导体验证成功的创新（如TSM校准参数）同步到主分支

### 场景3: 半导体框架迁移到其他行业
```
/migrate-framework 半导体 消费品
```
将v20.0预测市场框架核心文件迁移到其他行业worktree

## 安全保护

```yaml
禁止操作:
  ❌ 覆盖未备份的文件
  ❌ 迁移到错误的worktree
  ❌ 破坏半导体专业化配置（PMSI权重/Kill Switch阈值）
  ❌ 跳过冲突确认

半导体特殊保护:
  ❌ 不可将通用PMSI权重覆盖半导体PMSI权重
  ❌ 不可将通用Kill Switch阈值覆盖半导体阈值
  ✅ 合并时保留半导体特化参数

强制确认:
  - 每次迁移前显示完整计划
  - 每个冲突文件单独确认
  - 迁移完成后验证报告
```

## 版本
v1.0-半导体 - 2026-02-06
